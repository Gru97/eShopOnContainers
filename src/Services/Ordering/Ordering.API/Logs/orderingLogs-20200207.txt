2020-02-07T10:06:05.9597753+00:00  [INF] Inside UserCheckoutIntegrationEvent handler (3529aed2)
2020-02-07T10:06:06.0077335+00:00  [INF] CreateOrderCommand created CreateOrderCommand { OrderItems: [OrderItemDto { ProductId: 14, ProductName: "لپ تاپ 13 اینچی اپل مدل MacBook Pro MV972 2019 همراه با تاچ بار", Quantity: 1, UnitPrice: 26000000.0, Discount: 0 }], UserId: "5c353957-2e04-4814-820b-2bfdf5b6c246", UserName: "zahra", City: "اصفهان", State: "اصفهان", Country: "ایران", Street: "فروغی", ZipCode: "123456" } (3fd9f466)
2020-02-07T10:06:08.1834393+00:00  [INF] Order instantiated Order { OrderDate: 02/07/2020 10:06:08, Address: Address { Street: "فروغی", City: "اصفهان", State: "اصفهان", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "5c353957-2e04-4814-820b-2bfdf5b6c246", UserName: "zahra", Order: Order { OrderDate: 02/07/2020 10:06:08, Address: Address { Street: "فروغی", City: "اصفهان", State: "اصفهان", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "5c353957-2e04-4814-820b-2bfdf5b6c246", UserName: "zahra", Order: Order { OrderDate: 02/07/2020 10:06:08, Address: Address { Street: "فروغی", City: "اصفهان", State: "اصفهان", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "5c353957-2e04-4814-820b-2bfdf5b6c246", UserName: "zahra", Order: Order { OrderDate: null, Address: null, BuyerId: null, OrderState: null, OrderItems: null, Id: null, DomainEvents: null }, Id: 425aa107-b4e5-482e-a263-5f72473bbfdc, CreationDate: 02/07/2020 10:06:08 }] }, Id: 425aa107-b4e5-482e-a263-5f72473bbfdc, CreationDate: 02/07/2020 10:06:08 }] }, Id: 425aa107-b4e5-482e-a263-5f72473bbfdc, CreationDate: 02/07/2020 10:06:08 }] } (2c6718b0)
2020-02-07T10:06:08.5716925+00:00  [WRN] No type was specified for the decimal column '"Discount"' on entity type '"OrderItem"'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values using 'HasColumnType()'. (3a0db05f)
2020-02-07T10:06:08.5941906+00:00  [WRN] No type was specified for the decimal column '"UnitPrice"' on entity type '"OrderItem"'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values using 'HasColumnType()'. (3a0db05f)
2020-02-07T10:06:08.6757489+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T10:06:09.1685036+00:00  [INF] Executed DbCommand ("7"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT NEXT VALUE FOR [orderseq]" (0723d8ff)
2020-02-07T10:06:09.2613742+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT NEXT VALUE FOR [orderitemseq]" (0723d8ff)
2020-02-07T10:06:09.7532596+00:00  [INF] Executed DbCommand ("3"ms) [Parameters=["@__buyerIdentityGuid_0='?' (Size = 450)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(2) [e].[Id], [e].[IdentityGuid], [e].[Name]
FROM [Buyers] AS [e]
WHERE [e].[IdentityGuid] = @__buyerIdentityGuid_0" (0723d8ff)
2020-02-07T10:06:09.8648935+00:00  [INF] BuyerCreatedDomainEvent added to list of buyer events (70d1b556)
2020-02-07T10:06:09.9613401+00:00  [INF] Executed DbCommand ("4"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T10:06:10.0152535+00:00  [INF] order retrieved to set its buyer Order { OrderDate: 02/07/2020 10:06:08, Address: Address { Street: "فروغی", City: "اصفهان", State: "اصفهان", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 26000000.0, ProductId: 14, ProductName: "لپ تاپ 13 اینچی اپل مدل MacBook Pro MV972 2019 همراه با تاچ بار", Discount: 0, PictureUri: null, Id: 60, DomainEvents: null }, OrderItem { Quantity: 1, UnitPrice: 750000000.00, ProductId: 13, ProductName: "لپ تاپ 15 اینچی اچ پی مدل da0055nia - B", Discount: 0.00, PictureUri: null, Id: 61, DomainEvents: null }], Id: 60, DomainEvents: [] } (eee39e3d)
2020-02-07T10:06:10.0194976+00:00  [INF] buyerId set to 2 (1a2d05fe)
2020-02-07T10:06:10.0248772+00:00  [INF] OrderStatus is set to SetAwaitingValidationStatus  (8d340758)
2020-02-07T10:06:10.0605179+00:00  [INF] OrderStatusChangedToAwaitingValidationDomainEvent handler called (622cbd86)
2020-02-07T10:06:10.0688000+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is created OrderStatusChangedToAwaitingValidationIntegrationEvent { StockItems: [StockItem { ProductId: 14, Units: 1 }, StockItem { ProductId: 13, Units: 1 }], OrderId: 60, Id: 00000000-0000-0000-0000-000000000000, CreationDate: 02/07/2020 10:06:10 } (ff364eea)
2020-02-07T10:06:10.1654298+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is published (5de65a50)
2020-02-07T10:06:10.2746278+00:00  [ERR] Failed executing DbCommand ("7"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (60).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
ClientConnectionId:eb2a8ce7-a9d0-4094-8ed5-e67b5bd2d8ff
Error Number:2627,State:1,Class:14
2020-02-07T10:06:10.3127267+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (60).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (60).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2020-02-07T10:06:12.1761680+00:00  [ERR] Failed executing DbCommand ("29"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (60).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:eb2a8ce7-a9d0-4094-8ed5-e67b5bd2d8ff
Error Number:2627,State:1,Class:14
2020-02-07T10:06:12.1935823+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (60).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (60).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T10:06:13.0928166+00:00  [INF] SaveChanges called on buyer (3505242c)
2020-02-07T10:06:13.1108866+00:00  [ERR] Failed executing DbCommand ("5"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (60).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:eb2a8ce7-a9d0-4094-8ed5-e67b5bd2d8ff
Error Number:2627,State:1,Class:14
2020-02-07T10:06:13.1804567+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (60).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (60).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T10:06:14.1185634+00:00  [INF] Order SaveChanges finished (85d05615)
2020-02-07T10:06:14.1314510+00:00  [INF] CreateOrderCommand sent (8a728658)
2020-02-07T10:06:19.6789150+00:00  [INF] Timed Hosted Service running. (e41a204c)
2020-02-07T10:06:52.9963850+00:00 0HLTBMLQ55CSU:00000001 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/LatestOrderStatus/BuyerId/5c353957-2e04-4814-820b-2bfdf5b6c246   (ca22a1cb)
2020-02-07T10:06:53.8267675+00:00 0HLTBMLQ55CSU:00000001 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (500cc934)
2020-02-07T10:06:54.1910197+00:00 0HLTBMLQ55CSU:00000001 [INF] Route matched with "{action = \"GetLatestOrderForUser\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetLatestOrderForUser(System.String)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T10:06:54.3823940+00:00 0HLTBMLQ55CSU:00000001 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T10:06:55.2608140+00:00 0HLTBMLQ55CSU:00000001 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 858.7357ms. (50a9e262)
2020-02-07T10:06:55.3382086+00:00 0HLTBMLQ55CSU:00000001 [INF] Executing ObjectResult, writing value of type '"System.String"'. (8a1b66c8)
2020-02-07T10:06:55.5236986+00:00 0HLTBMLQ55CSU:00000001 [INF] Executed action "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" in 1228.8911ms (afa2e885)
2020-02-07T10:06:55.5376102+00:00 0HLTBMLQ55CSU:00000001 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (99874f2b)
2020-02-07T10:06:55.6606299+00:00 0HLTBMLQ55CSU:00000001 [INF] Request finished in 2659.5626ms 200 text/plain; charset=utf-8 (791a596a)
2020-02-07T10:19:16.2964032+00:00  [INF] Inside UserCheckoutIntegrationEvent handler (3529aed2)
2020-02-07T10:19:16.3459382+00:00  [INF] CreateOrderCommand created CreateOrderCommand { OrderItems: [OrderItemDto { ProductId: 14, ProductName: "لپ تاپ 13 اینچی اپل مدل MacBook Pro MV972 2019 همراه با تاچ بار", Quantity: 1, UnitPrice: 26000000.0, Discount: 0 }], UserId: "5c353957-2e04-4814-820b-2bfdf5b6c246", UserName: "zahra", City: "اصفهان", State: "اصفهان", Country: "ایران", Street: "فروغی", ZipCode: "123456" } (3fd9f466)
2020-02-07T10:19:17.6318017+00:00  [INF] Order instantiated Order { OrderDate: 02/07/2020 10:19:17, Address: Address { Street: "فروغی", City: "اصفهان", State: "اصفهان", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "5c353957-2e04-4814-820b-2bfdf5b6c246", UserName: "zahra", Order: Order { OrderDate: 02/07/2020 10:19:17, Address: Address { Street: "فروغی", City: "اصفهان", State: "اصفهان", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "5c353957-2e04-4814-820b-2bfdf5b6c246", UserName: "zahra", Order: Order { OrderDate: 02/07/2020 10:19:17, Address: Address { Street: "فروغی", City: "اصفهان", State: "اصفهان", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "5c353957-2e04-4814-820b-2bfdf5b6c246", UserName: "zahra", Order: Order { OrderDate: null, Address: null, BuyerId: null, OrderState: null, OrderItems: null, Id: null, DomainEvents: null }, Id: a8cff133-85b9-4402-b24f-031a88d87618, CreationDate: 02/07/2020 10:19:17 }] }, Id: a8cff133-85b9-4402-b24f-031a88d87618, CreationDate: 02/07/2020 10:19:17 }] }, Id: a8cff133-85b9-4402-b24f-031a88d87618, CreationDate: 02/07/2020 10:19:17 }] } (2c6718b0)
2020-02-07T10:19:17.9242585+00:00  [WRN] No type was specified for the decimal column '"Discount"' on entity type '"OrderItem"'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values using 'HasColumnType()'. (3a0db05f)
2020-02-07T10:19:17.9472868+00:00  [WRN] No type was specified for the decimal column '"UnitPrice"' on entity type '"OrderItem"'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values using 'HasColumnType()'. (3a0db05f)
2020-02-07T10:19:18.0315487+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T10:19:18.4333102+00:00  [INF] Executed DbCommand ("6"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT NEXT VALUE FOR [orderseq]" (0723d8ff)
2020-02-07T10:19:18.5344167+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT NEXT VALUE FOR [orderitemseq]" (0723d8ff)
2020-02-07T10:19:19.1397016+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=["@__buyerIdentityGuid_0='?' (Size = 450)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(2) [e].[Id], [e].[IdentityGuid], [e].[Name]
FROM [Buyers] AS [e]
WHERE [e].[IdentityGuid] = @__buyerIdentityGuid_0" (0723d8ff)
2020-02-07T10:19:19.3152850+00:00  [INF] BuyerCreatedDomainEvent added to list of buyer events (70d1b556)
2020-02-07T10:19:19.4747043+00:00  [INF] Executed DbCommand ("69"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T10:19:19.5611392+00:00  [INF] order retrieved to set its buyer Order { OrderDate: 02/07/2020 10:19:17, Address: Address { Street: "فروغی", City: "اصفهان", State: "اصفهان", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 26000000.0, ProductId: 14, ProductName: "لپ تاپ 13 اینچی اپل مدل MacBook Pro MV972 2019 همراه با تاچ بار", Discount: 0, PictureUri: null, Id: 61, DomainEvents: null }, OrderItem { Quantity: 1, UnitPrice: 85000.00, ProductId: 20, ProductName: "ماوس گرین GM-101", Discount: 0.00, PictureUri: null, Id: 62, DomainEvents: null }], Id: 61, DomainEvents: [] } (eee39e3d)
2020-02-07T10:19:19.5669960+00:00  [INF] orderId is 61 (6360224c)
2020-02-07T10:19:19.5747756+00:00  [INF] buyerId set to 2 (1a2d05fe)
2020-02-07T10:19:19.5820061+00:00  [INF] OrderStatus is set to SetAwaitingValidationStatus  (8d340758)
2020-02-07T10:19:19.6154510+00:00  [INF] OrderStatusChangedToAwaitingValidationDomainEvent handler called (622cbd86)
2020-02-07T10:19:19.6199780+00:00  [INF] OrderId is 61 (9c7ce781)
2020-02-07T10:19:19.6261029+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is created OrderStatusChangedToAwaitingValidationIntegrationEvent { StockItems: [StockItem { ProductId: 14, Units: 1 }, StockItem { ProductId: 20, Units: 1 }], OrderId: 61, Id: 00000000-0000-0000-0000-000000000000, CreationDate: 02/07/2020 10:19:19 } (ff364eea)
2020-02-07T10:19:19.6898570+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is published (5de65a50)
2020-02-07T10:19:19.7630746+00:00  [ERR] Failed executing DbCommand ("4"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (61).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
ClientConnectionId:ba1aa1a2-f760-486e-b47a-d04d5d14f287
Error Number:2627,State:1,Class:14
2020-02-07T10:19:19.7901693+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (61).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (61).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T10:19:21.6284456+00:00  [ERR] Failed executing DbCommand ("2"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (61).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:ba1aa1a2-f760-486e-b47a-d04d5d14f287
Error Number:2627,State:1,Class:14
2020-02-07T10:19:21.6613992+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (61).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (61).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T10:19:22.3123492+00:00  [INF] SaveChanges called on buyer (3505242c)
2020-02-07T10:19:22.3436024+00:00  [ERR] Failed executing DbCommand ("23"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (61).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:ba1aa1a2-f760-486e-b47a-d04d5d14f287
Error Number:2627,State:1,Class:14
2020-02-07T10:19:22.3596960+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (61).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (61).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T10:19:23.3752649+00:00  [INF] Order SaveChanges finished (85d05615)
2020-02-07T10:19:23.3942079+00:00  [INF] CreateOrderCommand sent (8a728658)
2020-02-07T10:19:27.8476332+00:00  [INF] Timed Hosted Service running. (e41a204c)
2020-02-07T10:26:12.6246770+00:00  [INF] Timed Hosted Service running. (e41a204c)
2020-02-07T10:29:18.6824643+00:00 0HLTBN2B4SOB0:00000001 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/all?pageSize=5&pageIndex=0   (ca22a1cb)
2020-02-07T10:29:18.7088083+00:00 0HLTBN2B4SOB0:00000001 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T10:29:18.7138864+00:00 0HLTBN2B4SOB0:00000001 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T10:29:18.9838857+00:00 0HLTBN2B4SOB0:00000001 [INF] Request finished in 288.2539ms 204  (791a596a)
2020-02-07T10:29:19.0170829+00:00 0HLTBN2B4SOB0:00000002 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/all?pageSize=5&pageIndex=0 application/json; charset=utf-8  (ca22a1cb)
2020-02-07T10:29:19.0219736+00:00 0HLTBN2B4SOB0:00000002 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T10:29:19.0278168+00:00 0HLTBN2B4SOB0:00000002 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T10:29:20.6055665+00:00 0HLTBN2B4SOB0:00000002 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetAll (Ordering.API)"' (500cc934)
2020-02-07T10:29:21.1523483+00:00 0HLTBN2B4SOB0:00000002 [INF] Route matched with "{action = \"GetAll\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetAll(Int32, Int32)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T10:29:21.5484607+00:00 0HLTBN2B4SOB0:00000002 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T10:29:24.3810067+00:00 0HLTBN2B4SOB0:00000002 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.NoContentResult" in 2818.6445ms. (50a9e262)
2020-02-07T10:29:24.4994271+00:00 0HLTBN2B4SOB0:00000002 [INF] Executing HttpStatusCodeResult, setting HTTP status code 204 (e28ccfae)
2020-02-07T10:29:24.5689169+00:00 0HLTBN2B4SOB0:00000002 [INF] Executed action "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)" in 3372.8532ms (afa2e885)
2020-02-07T10:29:24.6345527+00:00 0HLTBN2B4SOB0:00000002 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetAll (Ordering.API)"' (99874f2b)
2020-02-07T10:29:24.6668112+00:00 0HLTBN2B4SOB0:00000002 [INF] Request finished in 5667.2742ms 204  (791a596a)
2020-02-07T10:30:31.1541344+00:00  [INF] Inside UserCheckoutIntegrationEvent handler (3529aed2)
2020-02-07T10:30:31.3297861+00:00  [INF] CreateOrderCommand created CreateOrderCommand { OrderItems: [OrderItemDto { ProductId: 1, ProductName: "لپ تاپ 15 اینچی لنوو مدل Ideapad 330 - F", Quantity: 1, UnitPrice: 5000000.0, Discount: 0 }], UserId: "5c353957-2e04-4814-820b-2bfdf5b6c246", UserName: "zahra", City: "اصفهان", State: "اصفهان", Country: "ایران", Street: "فروغی", ZipCode: "123456" } (3fd9f466)
2020-02-07T10:30:32.8093151+00:00  [INF] Order instantiated Order { OrderDate: 02/07/2020 10:30:32, Address: Address { Street: "فروغی", City: "اصفهان", State: "اصفهان", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "5c353957-2e04-4814-820b-2bfdf5b6c246", UserName: "zahra", Order: Order { OrderDate: 02/07/2020 10:30:32, Address: Address { Street: "فروغی", City: "اصفهان", State: "اصفهان", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "5c353957-2e04-4814-820b-2bfdf5b6c246", UserName: "zahra", Order: Order { OrderDate: 02/07/2020 10:30:32, Address: Address { Street: "فروغی", City: "اصفهان", State: "اصفهان", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "5c353957-2e04-4814-820b-2bfdf5b6c246", UserName: "zahra", Order: Order { OrderDate: null, Address: null, BuyerId: null, OrderState: null, OrderItems: null, Id: null, DomainEvents: null }, Id: 03976869-271d-4c17-b57f-6a7875004510, CreationDate: 02/07/2020 10:30:32 }] }, Id: 03976869-271d-4c17-b57f-6a7875004510, CreationDate: 02/07/2020 10:30:32 }] }, Id: 03976869-271d-4c17-b57f-6a7875004510, CreationDate: 02/07/2020 10:30:32 }] } (2c6718b0)
2020-02-07T10:30:34.2959711+00:00  [WRN] No type was specified for the decimal column '"Discount"' on entity type '"OrderItem"'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values using 'HasColumnType()'. (3a0db05f)
2020-02-07T10:30:34.3150681+00:00  [WRN] No type was specified for the decimal column '"UnitPrice"' on entity type '"OrderItem"'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values using 'HasColumnType()'. (3a0db05f)
2020-02-07T10:30:34.4781549+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T10:30:35.1461746+00:00  [INF] Executed DbCommand ("5"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT NEXT VALUE FOR [orderseq]" (0723d8ff)
2020-02-07T10:30:35.9639875+00:00  [INF] Executed DbCommand ("5"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT NEXT VALUE FOR [orderitemseq]" (0723d8ff)
2020-02-07T10:30:37.6999418+00:00  [INF] Executed DbCommand ("1"ms) [Parameters=["@__buyerIdentityGuid_0='?' (Size = 450)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(2) [e].[Id], [e].[IdentityGuid], [e].[Name]
FROM [Buyers] AS [e]
WHERE [e].[IdentityGuid] = @__buyerIdentityGuid_0" (0723d8ff)
2020-02-07T10:30:37.7752124+00:00  [INF] BuyerCreatedDomainEvent added to list of buyer events (70d1b556)
2020-02-07T10:30:37.9997667+00:00  [INF] Executed DbCommand ("22"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T10:30:38.0763844+00:00  [INF] order retrieved to set its buyer Order { OrderDate: 02/07/2020 10:30:32, Address: Address { Street: "فروغی", City: "اصفهان", State: "اصفهان", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 5000000.0, ProductId: 1, ProductName: "لپ تاپ 15 اینچی لنوو مدل Ideapad 330 - F", Discount: 0, PictureUri: null, Id: 1, DomainEvents: null }], Id: 1, DomainEvents: [] } (eee39e3d)
2020-02-07T10:30:38.0802011+00:00  [INF] orderId is 1 (6360224c)
2020-02-07T10:30:38.0846419+00:00  [INF] buyerId set to 2 (1a2d05fe)
2020-02-07T10:30:38.0913142+00:00  [INF] OrderStatus is set to SetAwaitingValidationStatus  (8d340758)
2020-02-07T10:30:38.2206127+00:00  [INF] OrderStatusChangedToAwaitingValidationDomainEvent handler called (622cbd86)
2020-02-07T10:30:38.2433670+00:00  [INF] OrderId is 1 (9c7ce781)
2020-02-07T10:30:38.2577502+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is created OrderStatusChangedToAwaitingValidationIntegrationEvent { StockItems: [StockItem { ProductId: 1, Units: 1 }], OrderId: 1, Id: 00000000-0000-0000-0000-000000000000, CreationDate: 02/07/2020 10:30:38 } (ff364eea)
2020-02-07T10:30:38.6510506+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is published (5de65a50)
2020-02-07T10:30:38.8284175+00:00  [INF] Executed DbCommand ("9"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (0723d8ff)
2020-02-07T10:30:38.9361743+00:00  [INF] Executed DbCommand ("91"ms) [Parameters=["@p10='?' (DbType = Int32), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (Size = 4000), @p16='?' (DbType = Int32), @p17='?' (DbType = Decimal)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [OrderItems] ([Id], [Discount], [OrderId], [PictureUri], [ProductId], [ProductName], [Quantity], [UnitPrice])
VALUES (@p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);" (0723d8ff)
2020-02-07T10:30:38.9957748+00:00  [INF] SaveChanges called on buyer (3505242c)
2020-02-07T10:30:39.0038654+00:00  [INF] Order SaveChanges finished (85d05615)
2020-02-07T10:30:39.0586331+00:00  [INF] CreateOrderCommand sent (8a728658)
2020-02-07T10:30:39.3458193+00:00  [INF] SetOrderStatusToStockConfirmedCommand created:SetOrderStatusToStockConfirmedCommand { orderId: 1 }  (5429d522)
2020-02-07T10:30:39.4315505+00:00  [INF] Order will be retrieved with Id= 1 (535d6bce)
2020-02-07T10:30:39.4433888+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T10:30:39.5805875+00:00  [INF] Executed DbCommand ("3"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T10:30:39.6458798+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T10:30:39.6599672+00:00  [INF] Order retrieved Order { OrderDate: 02/07/2020 10:30:32, Address: Address { Street: "فروغی", City: "اصفهان", State: "اصفهان", Country: "ایران", ZipCode: "123456" }, BuyerId: 2, OrderState: AwaitingValidation, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 5000000.00, ProductId: 1, ProductName: "لپ تاپ 15 اینچی لنوو مدل Ideapad 330 - F", Discount: 0.00, PictureUri: null, Id: 1, DomainEvents: null }], Id: 1, DomainEvents: null } (6f81d885)
2020-02-07T10:30:39.6653163+00:00  [INF] SetStockConfirmedStatus called on order object (37636d94)
2020-02-07T10:30:39.8038809+00:00  [INF] Executed DbCommand ("15"ms) [Parameters=["@p2='?' (DbType = Int32), @p0='?' (DbType = Int16), @p1='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
UPDATE [Orders] SET [OrderState] = @p0, [Description] = @p1
WHERE [Id] = @p2;
SELECT @@ROWCOUNT;" (0723d8ff)
2020-02-07T10:30:39.8356673+00:00  [INF] SaveChanges finished  (90950fbb)
2020-02-07T10:30:39.9172433+00:00  [INF] SetOrderStatusToStockConfirmedCommand sent  (74dba639)
2020-02-07T10:30:40.3782151+00:00 0HLTBN2B4SOB0:00000003 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/LatestOrderStatus/BuyerId/5c353957-2e04-4814-820b-2bfdf5b6c246   (ca22a1cb)
2020-02-07T10:30:40.3873397+00:00 0HLTBN2B4SOB0:00000003 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T10:30:40.3957816+00:00 0HLTBN2B4SOB0:00000003 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T10:30:40.4016502+00:00 0HLTBN2B4SOB0:00000003 [INF] Request finished in 24.3616ms 204  (791a596a)
2020-02-07T10:30:40.4109092+00:00 0HLTBN2B4SOB0:00000004 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/LatestOrderStatus/BuyerId/5c353957-2e04-4814-820b-2bfdf5b6c246 application/json; charset=utf-8  (ca22a1cb)
2020-02-07T10:30:40.4165053+00:00 0HLTBN2B4SOB0:00000004 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T10:30:40.4220135+00:00 0HLTBN2B4SOB0:00000004 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T10:30:40.4678900+00:00 0HLTBN2B4SOB0:00000004 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (500cc934)
2020-02-07T10:30:40.4836187+00:00 0HLTBN2B4SOB0:00000004 [INF] Route matched with "{action = \"GetLatestOrderForUser\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetLatestOrderForUser(System.String)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T10:30:40.4908413+00:00 0HLTBN2B4SOB0:00000004 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T10:30:40.7313163+00:00 0HLTBN2B4SOB0:00000004 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 234.4094ms. (50a9e262)
2020-02-07T10:30:40.8650291+00:00 0HLTBN2B4SOB0:00000004 [INF] Executing ObjectResult, writing value of type '"null"'. (8a1b66c8)
2020-02-07T10:30:40.8701477+00:00 0HLTBN2B4SOB0:00000004 [INF] Executed action "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" in 381.7662ms (afa2e885)
2020-02-07T10:30:40.8786743+00:00 0HLTBN2B4SOB0:00000004 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (99874f2b)
2020-02-07T10:30:40.8873271+00:00 0HLTBN2B4SOB0:00000004 [INF] Request finished in 474.162ms 204  (791a596a)
2020-02-07T10:43:00.9000972+00:00  [INF] Inside UserCheckoutIntegrationEvent handler (3529aed2)
2020-02-07T10:43:00.9080440+00:00  [INF] CreateOrderCommand created CreateOrderCommand { OrderItems: [OrderItemDto { ProductId: 1, ProductName: "لپ تاپ 15 اینچی لنوو مدل Ideapad 330 - F", Quantity: 1, UnitPrice: 5000000.0, Discount: 0 }, OrderItemDto { ProductId: 20, ProductName: "ماوس گرین GM-101", Quantity: 1, UnitPrice: 85000.0, Discount: 0 }], UserId: "5c353957-2e04-4814-820b-2bfdf5b6c246", UserName: "zahra", City: "اصفهان", State: "اصفهان", Country: "ایران", Street: "فروغی", ZipCode: "123456" } (3fd9f466)
2020-02-07T10:43:00.9231142+00:00  [INF] Order instantiated Order { OrderDate: 02/07/2020 10:43:00, Address: Address { Street: "فروغی", City: "اصفهان", State: "اصفهان", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "5c353957-2e04-4814-820b-2bfdf5b6c246", UserName: "zahra", Order: Order { OrderDate: 02/07/2020 10:43:00, Address: Address { Street: "فروغی", City: "اصفهان", State: "اصفهان", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "5c353957-2e04-4814-820b-2bfdf5b6c246", UserName: "zahra", Order: Order { OrderDate: 02/07/2020 10:43:00, Address: Address { Street: "فروغی", City: "اصفهان", State: "اصفهان", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "5c353957-2e04-4814-820b-2bfdf5b6c246", UserName: "zahra", Order: Order { OrderDate: null, Address: null, BuyerId: null, OrderState: null, OrderItems: null, Id: null, DomainEvents: null }, Id: 218324d8-56ff-4aa2-9109-71e66f951488, CreationDate: 02/07/2020 10:43:00 }] }, Id: 218324d8-56ff-4aa2-9109-71e66f951488, CreationDate: 02/07/2020 10:43:00 }] }, Id: 218324d8-56ff-4aa2-9109-71e66f951488, CreationDate: 02/07/2020 10:43:00 }] } (2c6718b0)
2020-02-07T10:43:00.9914005+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T10:43:01.1337802+00:00  [INF] Executed DbCommand ("7"ms) [Parameters=["@__buyerIdentityGuid_0='?' (Size = 450)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(2) [e].[Id], [e].[IdentityGuid], [e].[Name]
FROM [Buyers] AS [e]
WHERE [e].[IdentityGuid] = @__buyerIdentityGuid_0" (0723d8ff)
2020-02-07T10:43:01.1534137+00:00  [INF] BuyerCreatedDomainEvent added to list of buyer events (70d1b556)
2020-02-07T10:43:02.1635962+00:00  [INF] Executed DbCommand ("4"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T10:43:02.2226788+00:00  [INF] order retrieved to set its buyer Order { OrderDate: 02/07/2020 10:43:00, Address: Address { Street: "فروغی", City: "اصفهان", State: "اصفهان", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 5000000.0, ProductId: 1, ProductName: "لپ تاپ 15 اینچی لنوو مدل Ideapad 330 - F", Discount: 0, PictureUri: null, Id: 2, DomainEvents: null }, OrderItem { Quantity: 1, UnitPrice: 85000.0, ProductId: 20, ProductName: "ماوس گرین GM-101", Discount: 0, PictureUri: null, Id: 3, DomainEvents: null }], Id: 2, DomainEvents: [] } (eee39e3d)
2020-02-07T10:43:02.2308628+00:00  [INF] orderId is 2 (6360224c)
2020-02-07T10:43:02.2381994+00:00  [INF] buyerId set to 2 (1a2d05fe)
2020-02-07T10:43:02.2489847+00:00  [INF] OrderStatus is set to SetAwaitingValidationStatus  (8d340758)
2020-02-07T10:43:02.2792983+00:00  [INF] OrderStatusChangedToAwaitingValidationDomainEvent handler called (622cbd86)
2020-02-07T10:43:02.2846309+00:00  [INF] OrderId is 2 (9c7ce781)
2020-02-07T10:43:02.3026779+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is created OrderStatusChangedToAwaitingValidationIntegrationEvent { StockItems: [StockItem { ProductId: 1, Units: 1 }, StockItem { ProductId: 20, Units: 1 }], OrderId: 2, Id: 00000000-0000-0000-0000-000000000000, CreationDate: 02/07/2020 10:43:02 } (ff364eea)
2020-02-07T10:43:02.4667676+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is published (5de65a50)
2020-02-07T10:43:02.4932201+00:00  [INF] Executed DbCommand ("13"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (0723d8ff)
2020-02-07T10:43:02.5373982+00:00  [INF] Executed DbCommand ("28"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Decimal), @p2='?' (DbType = Int32), @p3='?' (Size = 4000), @p4='?' (DbType = Int32), @p5='?' (Size = 4000), @p6='?' (DbType = Int32), @p7='?' (DbType = Decimal)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [OrderItems] ([Id], [Discount], [OrderId], [PictureUri], [ProductId], [ProductName], [Quantity], [UnitPrice])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);" (0723d8ff)
2020-02-07T10:43:02.5670788+00:00  [INF] Executed DbCommand ("23"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Decimal), @p2='?' (DbType = Int32), @p3='?' (Size = 4000), @p4='?' (DbType = Int32), @p5='?' (Size = 4000), @p6='?' (DbType = Int32), @p7='?' (DbType = Decimal)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [OrderItems] ([Id], [Discount], [OrderId], [PictureUri], [ProductId], [ProductName], [Quantity], [UnitPrice])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);" (0723d8ff)
2020-02-07T10:43:02.5847370+00:00  [INF] SaveChanges called on buyer (3505242c)
2020-02-07T10:43:02.5976442+00:00  [INF] Order SaveChanges finished (85d05615)
2020-02-07T10:43:02.6194403+00:00  [INF] CreateOrderCommand sent (8a728658)
2020-02-07T10:43:02.6800114+00:00  [INF] SetOrderStatusToStockRejectedCommand created { @cmd} (e9c5261c)
2020-02-07T10:43:02.7161005+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T10:43:02.7491882+00:00  [INF] Executed DbCommand ("25"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T10:43:02.7716105+00:00  [INF] Executed DbCommand ("5"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T10:43:02.7883975+00:00  [INF] order retrieved to be set as rejected. Ordering.Domain.AggregatesModel.OrderAggregate.Order (bfe0f450)
2020-02-07T10:43:02.7949487+00:00  [INF] order status changed to rejected (7df0448d)
2020-02-07T10:43:03.4663295+00:00  [INF] Executed DbCommand ("4"ms) [Parameters=["@p2='?' (DbType = Int32), @p0='?' (DbType = Int16), @p1='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
UPDATE [Orders] SET [OrderState] = @p0, [Description] = @p1
WHERE [Id] = @p2;
SELECT @@ROWCOUNT;" (0723d8ff)
2020-02-07T10:43:03.4778826+00:00  [INF] SaveChanges called for order (877d402b)
2020-02-07T10:43:03.4841370+00:00  [INF] SetOrderStatusToStockRejectedCommand sent (02d4de29)
2020-02-07T10:43:12.3352398+00:00 0HLTBN2B4SOB1:00000001 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/LatestOrderStatus/BuyerId/5c353957-2e04-4814-820b-2bfdf5b6c246   (ca22a1cb)
2020-02-07T10:43:12.3438833+00:00 0HLTBN2B4SOB1:00000001 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T10:43:12.3496679+00:00 0HLTBN2B4SOB1:00000001 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T10:43:12.3552389+00:00 0HLTBN2B4SOB1:00000001 [INF] Request finished in 20.4301ms 204  (791a596a)
2020-02-07T10:43:12.3853732+00:00 0HLTBN2B4SOB1:00000002 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/LatestOrderStatus/BuyerId/5c353957-2e04-4814-820b-2bfdf5b6c246 application/json; charset=utf-8  (ca22a1cb)
2020-02-07T10:43:12.3909599+00:00 0HLTBN2B4SOB1:00000002 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T10:43:12.4047059+00:00 0HLTBN2B4SOB1:00000002 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T10:43:12.4093059+00:00 0HLTBN2B4SOB1:00000002 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (500cc934)
2020-02-07T10:43:12.4389929+00:00 0HLTBN2B4SOB1:00000002 [INF] Route matched with "{action = \"GetLatestOrderForUser\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetLatestOrderForUser(System.String)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T10:43:12.4521882+00:00 0HLTBN2B4SOB1:00000002 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T10:43:12.5270789+00:00 0HLTBN2B4SOB1:00000002 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 46.424ms. (50a9e262)
2020-02-07T10:43:12.5526144+00:00 0HLTBN2B4SOB1:00000002 [INF] Executing ObjectResult, writing value of type '"System.String"'. (8a1b66c8)
2020-02-07T10:43:12.6332331+00:00 0HLTBN2B4SOB1:00000002 [INF] Executed action "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" in 168.6604ms (afa2e885)
2020-02-07T10:43:12.6383423+00:00 0HLTBN2B4SOB1:00000002 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (99874f2b)
2020-02-07T10:43:12.6652372+00:00 0HLTBN2B4SOB1:00000002 [INF] Request finished in 277.1342ms 200 application/json; charset=utf-8 (791a596a)
2020-02-07T11:11:28.6248389+00:00  [INF] Timed Hosted Service running. (e41a204c)
2020-02-07T11:17:49.8785630+00:00  [INF] Timed Hosted Service running. (e41a204c)
2020-02-07T11:24:25.3584390+00:00  [INF] Timed Hosted Service running. (e41a204c)
2020-02-07T11:33:17.4157953+00:00  [INF] Timed Hosted Service running. (e41a204c)
2020-02-07T12:11:02.8495489+00:00  [INF] Timed Hosted Service running. (e41a204c)
2020-02-07T14:08:20.0745049+00:00 0HLTBQSNIR4JI:00000001 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/all?pageSize=5&pageIndex=0   (ca22a1cb)
2020-02-07T14:08:20.1594266+00:00 0HLTBQSNIR4JI:00000001 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T14:08:20.1674338+00:00 0HLTBQSNIR4JI:00000001 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T14:08:20.3362295+00:00 0HLTBQSNIR4JI:00000001 [INF] Request finished in 251.6383ms 204  (791a596a)
2020-02-07T14:08:20.3618419+00:00 0HLTBQSNIR4JI:00000002 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/all?pageSize=5&pageIndex=0 application/json; charset=utf-8  (ca22a1cb)
2020-02-07T14:08:20.3852198+00:00 0HLTBQSNIR4JI:00000002 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T14:08:20.3887772+00:00 0HLTBQSNIR4JI:00000002 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T14:08:21.8024149+00:00 0HLTBQSNIR4JI:00000002 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetAll (Ordering.API)"' (500cc934)
2020-02-07T14:08:22.2459063+00:00 0HLTBQSNIR4JI:00000002 [INF] Route matched with "{action = \"GetAll\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetAll(Int32, Int32)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T14:08:22.3711767+00:00 0HLTBQSNIR4JI:00000002 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T14:08:24.9095332+00:00 0HLTBQSNIR4JI:00000002 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.NoContentResult" in 2419.6919ms. (50a9e262)
2020-02-07T14:08:25.0150894+00:00 0HLTBQSNIR4JI:00000002 [INF] Executing HttpStatusCodeResult, setting HTTP status code 204 (e28ccfae)
2020-02-07T14:08:25.0857360+00:00 0HLTBQSNIR4JI:00000002 [INF] Executed action "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)" in 2815.917ms (afa2e885)
2020-02-07T14:08:25.1380790+00:00 0HLTBQSNIR4JI:00000002 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetAll (Ordering.API)"' (99874f2b)
2020-02-07T14:08:25.1903581+00:00 0HLTBQSNIR4JI:00000002 [INF] Request finished in 4829.1527ms 204  (791a596a)
2020-02-07T14:13:05.9732245+00:00  [INF] Inside UserCheckoutIntegrationEvent handler (3529aed2)
2020-02-07T14:13:06.0268682+00:00  [INF] CreateOrderCommand created CreateOrderCommand { OrderItems: [OrderItemDto { ProductId: 14, ProductName: "لپ تاپ 13 اینچی اپل مدل MacBook Pro MV972 2019 همراه با تاچ بار", Quantity: 1, UnitPrice: 26000000.0, Discount: 0 }], UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", City: "تهران", State: "تهران", Country: "ایران", Street: "آذربایجان", ZipCode: "123456" } (3fd9f466)
2020-02-07T14:13:06.4124175+00:00  [INF] Order instantiated Order { OrderDate: 02/07/2020 14:13:06, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 14:13:06, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 14:13:06, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: null, Address: null, BuyerId: null, OrderState: null, OrderItems: null, Id: null, DomainEvents: null }, Id: 86140648-1fbf-4884-a0d1-8a82b90968c4, CreationDate: 02/07/2020 14:13:06 }] }, Id: 86140648-1fbf-4884-a0d1-8a82b90968c4, CreationDate: 02/07/2020 14:13:06 }] }, Id: 86140648-1fbf-4884-a0d1-8a82b90968c4, CreationDate: 02/07/2020 14:13:06 }] } (2c6718b0)
2020-02-07T14:13:07.3150959+00:00  [WRN] No type was specified for the decimal column '"Discount"' on entity type '"OrderItem"'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values using 'HasColumnType()'. (3a0db05f)
2020-02-07T14:13:07.3274572+00:00  [WRN] No type was specified for the decimal column '"UnitPrice"' on entity type '"OrderItem"'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values using 'HasColumnType()'. (3a0db05f)
2020-02-07T14:13:07.3470575+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T14:13:08.1193678+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT NEXT VALUE FOR [orderseq]" (0723d8ff)
2020-02-07T14:13:09.0876928+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT NEXT VALUE FOR [orderitemseq]" (0723d8ff)
2020-02-07T14:13:11.1600572+00:00  [INF] Executed DbCommand ("1"ms) [Parameters=["@__buyerIdentityGuid_0='?' (Size = 450)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(2) [e].[Id], [e].[IdentityGuid], [e].[Name]
FROM [Buyers] AS [e]
WHERE [e].[IdentityGuid] = @__buyerIdentityGuid_0" (0723d8ff)
2020-02-07T14:13:11.3129913+00:00  [INF] BuyerCreatedDomainEvent added to list of buyer events (70d1b556)
2020-02-07T14:13:12.6712344+00:00  [INF] Executed DbCommand ("22"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T14:13:12.7521591+00:00  [INF] order retrieved to set its buyer Order { OrderDate: 02/07/2020 14:13:06, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 26000000.0, ProductId: 14, ProductName: "لپ تاپ 13 اینچی اپل مدل MacBook Pro MV972 2019 همراه با تاچ بار", Discount: 0, PictureUri: null, Id: 2, DomainEvents: null }, OrderItem { Quantity: 1, UnitPrice: 85000.00, ProductId: 20, ProductName: "ماوس گرین GM-101", Discount: 0.00, PictureUri: null, Id: 3, DomainEvents: null }], Id: 2, DomainEvents: [] } (eee39e3d)
2020-02-07T14:13:12.7741775+00:00  [INF] orderId is 2 (6360224c)
2020-02-07T14:13:12.7796046+00:00  [INF] buyerId set to 1 (b0efb381)
2020-02-07T14:13:12.8272567+00:00  [INF] OrderStatus is set to SetAwaitingValidationStatus  (8d340758)
2020-02-07T14:13:12.9030206+00:00  [INF] OrderStatusChangedToAwaitingValidationDomainEvent handler called (622cbd86)
2020-02-07T14:13:12.9166563+00:00  [INF] OrderId is 2 (9c7ce781)
2020-02-07T14:13:12.9288816+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is created OrderStatusChangedToAwaitingValidationIntegrationEvent { StockItems: [StockItem { ProductId: 14, Units: 1 }, StockItem { ProductId: 20, Units: 1 }], OrderId: 2, Id: 00000000-0000-0000-0000-000000000000, CreationDate: 02/07/2020 14:13:12 } (ff364eea)
2020-02-07T14:13:13.2047861+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is published (5de65a50)
2020-02-07T14:13:13.6958783+00:00  [INF] SetOrderStatusToStockRejectedCommand created { @cmd} (e9c5261c)
2020-02-07T14:13:13.7384769+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T14:13:14.1477041+00:00  [INF] Executed DbCommand ("59"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T14:13:14.2210510+00:00  [INF] Executed DbCommand ("4"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T14:13:14.2744170+00:00  [INF] order retrieved to be set as rejected. Ordering.Domain.AggregatesModel.OrderAggregate.Order (bfe0f450)
2020-02-07T14:13:14.2970026+00:00  [INF] order status changed to rejected (7df0448d)
2020-02-07T14:13:14.4003801+00:00  [INF] SaveChanges called for order (877d402b)
2020-02-07T14:13:14.5452447+00:00  [INF] SetOrderStatusToStockRejectedCommand sent (02d4de29)
2020-02-07T14:13:14.7530362+00:00  [ERR] Failed executing DbCommand ("152"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (2).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:29f64d01-8546-43ca-8591-f137a5884943
Error Number:2627,State:1,Class:14
2020-02-07T14:13:15.1140576+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (2).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (2).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T14:13:18.4378999+00:00  [ERR] Failed executing DbCommand ("71"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (2).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:5c54c22b-330c-4b12-9b59-f9b6291a7d9a
Error Number:2627,State:1,Class:14
2020-02-07T14:13:18.5049374+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (2).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (2).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T14:13:19.0097264+00:00 0HLTBQSNIR4JI:00000003 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c   (ca22a1cb)
2020-02-07T14:13:19.5039617+00:00 0HLTBQSNIR4JI:00000003 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T14:13:19.5075274+00:00  [INF] SaveChanges called on buyer (3505242c)
2020-02-07T14:13:19.5143565+00:00 0HLTBQSNIR4JI:00000003 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T14:13:19.5223590+00:00 0HLTBQSNIR4JI:00000003 [INF] Request finished in 511.1513ms 204  (791a596a)
2020-02-07T14:13:19.5404912+00:00 0HLTBQSNIR4JI:00000004 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c application/json; charset=utf-8  (ca22a1cb)
2020-02-07T14:13:19.5464135+00:00 0HLTBQSNIR4JI:00000004 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T14:13:19.5521843+00:00 0HLTBQSNIR4JI:00000004 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T14:13:19.5574585+00:00  [ERR] Failed executing DbCommand ("7"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (2).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:5c54c22b-330c-4b12-9b59-f9b6291a7d9a
Error Number:2627,State:1,Class:14
2020-02-07T14:13:19.5865493+00:00 0HLTBQSNIR4JI:00000004 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (500cc934)
2020-02-07T14:13:19.6899957+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (2).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (2).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T14:13:20.2332956+00:00 0HLTBQSNIR4JI:00000004 [INF] Route matched with "{action = \"GetLatestOrderForUser\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetLatestOrderForUser(System.String)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T14:13:20.7594952+00:00  [INF] Order SaveChanges finished (85d05615)
2020-02-07T14:13:20.7918613+00:00 0HLTBQSNIR4JI:00000004 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T14:13:21.0220727+00:00  [INF] CreateOrderCommand sent (8a728658)
2020-02-07T14:13:21.1495580+00:00 0HLTBQSNIR4JI:00000004 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 349.108ms. (50a9e262)
2020-02-07T14:13:21.1869613+00:00 0HLTBQSNIR4JI:00000004 [INF] Executing ObjectResult, writing value of type '"System.String"'. (8a1b66c8)
2020-02-07T14:13:21.2138754+00:00 0HLTBQSNIR4JI:00000004 [INF] Executed action "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" in 969.3583ms (afa2e885)
2020-02-07T14:13:21.2225220+00:00 0HLTBQSNIR4JI:00000004 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (99874f2b)
2020-02-07T14:13:21.2638038+00:00 0HLTBQSNIR4JI:00000004 [INF] Request finished in 1713.9434ms 200 application/json; charset=utf-8 (791a596a)
2020-02-07T14:13:35.1468858+00:00  [INF] Inside UserCheckoutIntegrationEvent handler (3529aed2)
2020-02-07T14:13:35.1556335+00:00  [INF] CreateOrderCommand created CreateOrderCommand { OrderItems: [OrderItemDto { ProductId: 22, ProductName: "هدفون بی سیم نیا مدل Q8-851S", Quantity: 1, UnitPrice: 95500.0, Discount: 0 }], UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", City: "تهران", State: "تهران", Country: "ایران", Street: "آذربایجان", ZipCode: "123456" } (3fd9f466)
2020-02-07T14:13:35.2660183+00:00  [INF] Order instantiated Order { OrderDate: 02/07/2020 14:13:35, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 14:13:35, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 14:13:35, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: null, Address: null, BuyerId: null, OrderState: null, OrderItems: null, Id: null, DomainEvents: null }, Id: 41f790dc-32a7-4c1c-8b59-72fef5795e4e, CreationDate: 02/07/2020 14:13:35 }] }, Id: 41f790dc-32a7-4c1c-8b59-72fef5795e4e, CreationDate: 02/07/2020 14:13:35 }] }, Id: 41f790dc-32a7-4c1c-8b59-72fef5795e4e, CreationDate: 02/07/2020 14:13:35 }] } (2c6718b0)
2020-02-07T14:13:35.3014192+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T14:13:35.3811627+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=["@__buyerIdentityGuid_0='?' (Size = 450)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(2) [e].[Id], [e].[IdentityGuid], [e].[Name]
FROM [Buyers] AS [e]
WHERE [e].[IdentityGuid] = @__buyerIdentityGuid_0" (0723d8ff)
2020-02-07T14:13:35.3996433+00:00  [INF] BuyerCreatedDomainEvent added to list of buyer events (70d1b556)
2020-02-07T14:13:37.3791959+00:00  [INF] Executed DbCommand ("27"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T14:13:37.3858786+00:00  [INF] order retrieved to set its buyer Order { OrderDate: 02/07/2020 14:13:35, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 95500.0, ProductId: 22, ProductName: "هدفون بی سیم نیا مدل Q8-851S", Discount: 0, PictureUri: null, Id: 3, DomainEvents: null }], Id: 3, DomainEvents: [] } (eee39e3d)
2020-02-07T14:13:37.3929559+00:00  [INF] orderId is 3 (6360224c)
2020-02-07T14:13:37.3986724+00:00  [INF] buyerId set to 1 (b0efb381)
2020-02-07T14:13:37.4055572+00:00  [INF] OrderStatus is set to SetAwaitingValidationStatus  (8d340758)
2020-02-07T14:13:38.3549123+00:00  [INF] OrderStatusChangedToAwaitingValidationDomainEvent handler called (622cbd86)
2020-02-07T14:13:38.3599776+00:00  [INF] OrderId is 3 (9c7ce781)
2020-02-07T14:13:38.3685069+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is created OrderStatusChangedToAwaitingValidationIntegrationEvent { StockItems: [StockItem { ProductId: 22, Units: 1 }], OrderId: 3, Id: 00000000-0000-0000-0000-000000000000, CreationDate: 02/07/2020 14:13:38 } (ff364eea)
2020-02-07T14:13:38.5361875+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is published (5de65a50)
2020-02-07T14:13:38.6242234+00:00  [INF] Executed DbCommand ("7"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (0723d8ff)
2020-02-07T14:13:38.7230420+00:00  [ERR] Failed executing DbCommand ("73"ms) [Parameters=["@p10='?' (DbType = Int32), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (Size = 4000), @p16='?' (DbType = Int32), @p17='?' (DbType = Decimal)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [OrderItems] ([Id], [Discount], [OrderId], [PictureUri], [ProductId], [ProductName], [Quantity], [UnitPrice])
VALUES (@p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:5c54c22b-330c-4b12-9b59-f9b6291a7d9a
Error Number:2627,State:1,Class:14
2020-02-07T14:13:38.7602256+00:00  [INF] SetOrderStatusToStockConfirmedCommand created:SetOrderStatusToStockConfirmedCommand { orderId: 3 }  (5429d522)
2020-02-07T14:13:38.9189093+00:00  [INF] Order will be retrieved with Id= 3 (535d6bce)
2020-02-07T14:13:38.9410166+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T14:13:38.9417556+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T14:13:40.0071459+00:00  [INF] Executed DbCommand ("533"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T14:13:40.0297328+00:00  [INF] Executed DbCommand ("4"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (0723d8ff)
2020-02-07T14:13:40.1043062+00:00  [ERR] Failed executing DbCommand ("24"ms) [Parameters=["@p10='?' (DbType = Int32), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (Size = 4000), @p16='?' (DbType = Int32), @p17='?' (DbType = Decimal)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [OrderItems] ([Id], [Discount], [OrderId], [PictureUri], [ProductId], [ProductName], [Quantity], [UnitPrice])
VALUES (@p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
ClientConnectionId:f2a33de5-5078-44b7-b41d-546ae0000597
Error Number:2627,State:1,Class:14
2020-02-07T14:13:40.1144366+00:00  [INF] retry for 0 (fe099784)
2020-02-07T14:13:40.1822854+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T14:13:41.3248820+00:00  [INF] SaveChanges called on buyer (3505242c)
2020-02-07T14:13:41.4002020+00:00  [INF] Executed DbCommand ("23"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T14:13:41.4096100+00:00  [INF] Executed DbCommand ("28"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (0723d8ff)
2020-02-07T14:13:41.4890743+00:00  [INF] retry for 1 (fe099784)
2020-02-07T14:13:41.4838199+00:00  [ERR] Failed executing DbCommand ("6"ms) [Parameters=["@p10='?' (DbType = Int32), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (Size = 4000), @p16='?' (DbType = Int32), @p17='?' (DbType = Decimal)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [OrderItems] ([Id], [Discount], [OrderId], [PictureUri], [ProductId], [ProductName], [Quantity], [UnitPrice])
VALUES (@p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:29f64d01-8546-43ca-8591-f137a5884943
Error Number:2627,State:1,Class:14
2020-02-07T14:13:41.6538619+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T14:13:42.7002877+00:00  [INF] Order SaveChanges finished (85d05615)
2020-02-07T14:13:42.7256301+00:00  [INF] CreateOrderCommand sent (8a728658)
2020-02-07T14:13:42.7630620+00:00  [INF] Executed DbCommand ("33"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T14:13:42.7909438+00:00  [INF] retry for 2 (fe099784)
2020-02-07T14:13:43.8051376+00:00  [INF] Executed DbCommand ("3"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T14:13:43.8149682+00:00  [INF] retry for 3 (fe099784)
2020-02-07T14:13:44.8836409+00:00  [INF] Executed DbCommand ("17"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T14:13:44.8972926+00:00  [INF] retry for 4 (fe099784)
2020-02-07T14:13:45.9085937+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T14:13:45.9193882+00:00  [INF] Order retrieved "(null)" (6f81d885)
2020-02-07T14:13:45.9475797+00:00  [INF] SetOrderStatusToStockConfirmedCommand sent  (74dba639)
2020-02-07T14:13:48.9235900+00:00 0HLTBQSNIR4JI:00000005 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c   (ca22a1cb)
2020-02-07T14:13:48.9365283+00:00 0HLTBQSNIR4JI:00000005 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T14:13:48.9403651+00:00 0HLTBQSNIR4JI:00000005 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T14:13:48.9596390+00:00 0HLTBQSNIR4JI:00000005 [INF] Request finished in 30.3118ms 204  (791a596a)
2020-02-07T14:13:48.9853649+00:00 0HLTBQSNIR4JI:00000006 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c application/json; charset=utf-8  (ca22a1cb)
2020-02-07T14:13:48.9957685+00:00 0HLTBQSNIR4JI:00000006 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T14:13:49.0181609+00:00 0HLTBQSNIR4JI:00000006 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T14:13:49.0244077+00:00 0HLTBQSNIR4JI:00000006 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (500cc934)
2020-02-07T14:13:49.0402060+00:00 0HLTBQSNIR4JI:00000006 [INF] Route matched with "{action = \"GetLatestOrderForUser\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetLatestOrderForUser(System.String)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T14:13:49.0472221+00:00 0HLTBQSNIR4JI:00000006 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T14:13:49.1650977+00:00 0HLTBQSNIR4JI:00000006 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 91.5376ms. (50a9e262)
2020-02-07T14:13:49.1757550+00:00 0HLTBQSNIR4JI:00000006 [INF] Executing ObjectResult, writing value of type '"System.String"'. (8a1b66c8)
2020-02-07T14:13:49.1891236+00:00 0HLTBQSNIR4JI:00000006 [INF] Executed action "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" in 136.1037ms (afa2e885)
2020-02-07T14:13:49.2121482+00:00 0HLTBQSNIR4JI:00000006 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (99874f2b)
2020-02-07T14:13:49.2192994+00:00 0HLTBQSNIR4JI:00000006 [INF] Request finished in 252.2112ms 200 application/json; charset=utf-8 (791a596a)
2020-02-07T14:14:15.8912642+00:00  [INF] Inside UserCheckoutIntegrationEvent handler (3529aed2)
2020-02-07T14:14:15.9094086+00:00  [INF] CreateOrderCommand created CreateOrderCommand { OrderItems: [OrderItemDto { ProductId: 22, ProductName: "هدفون بی سیم نیا مدل Q8-851S", Quantity: 1, UnitPrice: 95500.0, Discount: 0 }], UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", City: "تهران", State: "تهران", Country: "ایران", Street: "آذربایجان", ZipCode: "123456" } (3fd9f466)
2020-02-07T14:14:15.9959042+00:00  [INF] Order instantiated Order { OrderDate: 02/07/2020 14:14:15, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 14:14:15, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 14:14:15, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: null, Address: null, BuyerId: null, OrderState: null, OrderItems: null, Id: null, DomainEvents: null }, Id: db5ed63c-5f9f-4b56-87ae-206f24d5d155, CreationDate: 02/07/2020 14:14:15 }] }, Id: db5ed63c-5f9f-4b56-87ae-206f24d5d155, CreationDate: 02/07/2020 14:14:15 }] }, Id: db5ed63c-5f9f-4b56-87ae-206f24d5d155, CreationDate: 02/07/2020 14:14:15 }] } (2c6718b0)
2020-02-07T14:14:16.0672613+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T14:14:16.1842726+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=["@__buyerIdentityGuid_0='?' (Size = 450)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(2) [e].[Id], [e].[IdentityGuid], [e].[Name]
FROM [Buyers] AS [e]
WHERE [e].[IdentityGuid] = @__buyerIdentityGuid_0" (0723d8ff)
2020-02-07T14:14:16.2134076+00:00  [INF] BuyerCreatedDomainEvent added to list of buyer events (70d1b556)
2020-02-07T14:14:16.8668908+00:00  [INF] Executed DbCommand ("3"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T14:14:16.8822054+00:00  [INF] order retrieved to set its buyer Order { OrderDate: 02/07/2020 14:14:15, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 95500.0, ProductId: 22, ProductName: "هدفون بی سیم نیا مدل Q8-851S", Discount: 0, PictureUri: null, Id: 4, DomainEvents: null }], Id: 4, DomainEvents: [] } (eee39e3d)
2020-02-07T14:14:16.8865862+00:00  [INF] orderId is 4 (6360224c)
2020-02-07T14:14:16.8913247+00:00  [INF] buyerId set to 1 (b0efb381)
2020-02-07T14:14:16.8959015+00:00  [INF] OrderStatus is set to SetAwaitingValidationStatus  (8d340758)
2020-02-07T14:14:16.9822154+00:00  [INF] OrderStatusChangedToAwaitingValidationDomainEvent handler called (622cbd86)
2020-02-07T14:14:17.0046578+00:00  [INF] OrderId is 4 (9c7ce781)
2020-02-07T14:14:17.0271963+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is created OrderStatusChangedToAwaitingValidationIntegrationEvent { StockItems: [StockItem { ProductId: 22, Units: 1 }], OrderId: 4, Id: 00000000-0000-0000-0000-000000000000, CreationDate: 02/07/2020 14:14:17 } (ff364eea)
2020-02-07T14:14:17.1394262+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is published (5de65a50)
2020-02-07T14:14:17.2032587+00:00  [INF] Executed DbCommand ("10"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (0723d8ff)
2020-02-07T14:14:17.2299205+00:00  [INF] Executed DbCommand ("21"ms) [Parameters=["@p10='?' (DbType = Int32), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (Size = 4000), @p16='?' (DbType = Int32), @p17='?' (DbType = Decimal)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [OrderItems] ([Id], [Discount], [OrderId], [PictureUri], [ProductId], [ProductName], [Quantity], [UnitPrice])
VALUES (@p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);" (0723d8ff)
2020-02-07T14:14:17.2507750+00:00  [INF] SaveChanges called on buyer (3505242c)
2020-02-07T14:14:17.2607925+00:00  [INF] Order SaveChanges finished (85d05615)
2020-02-07T14:14:17.2730523+00:00  [INF] CreateOrderCommand sent (8a728658)
2020-02-07T14:14:17.3596571+00:00  [INF] SetOrderStatusToStockConfirmedCommand created:SetOrderStatusToStockConfirmedCommand { orderId: 4 }  (5429d522)
2020-02-07T14:14:17.3697909+00:00  [INF] Order will be retrieved with Id= 4 (535d6bce)
2020-02-07T14:14:17.3773850+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T14:14:17.4125851+00:00  [INF] Executed DbCommand ("3"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T14:14:17.4972608+00:00  [INF] Executed DbCommand ("3"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T14:14:17.5134929+00:00  [INF] Order retrieved Order { OrderDate: 02/07/2020 14:14:15, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: 1, OrderState: AwaitingValidation, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 95500.00, ProductId: 22, ProductName: "هدفون بی سیم نیا مدل Q8-851S", Discount: 0.00, PictureUri: null, Id: 4, DomainEvents: null }], Id: 4, DomainEvents: null } (6f81d885)
2020-02-07T14:14:17.5195271+00:00  [INF] SetStockConfirmedStatus called on order object (37636d94)
2020-02-07T14:14:17.6109617+00:00  [INF] Executed DbCommand ("1"ms) [Parameters=["@p2='?' (DbType = Int32), @p0='?' (DbType = Int16), @p1='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
UPDATE [Orders] SET [OrderState] = @p0, [Description] = @p1
WHERE [Id] = @p2;
SELECT @@ROWCOUNT;" (0723d8ff)
2020-02-07T14:14:17.6572035+00:00  [INF] SaveChanges finished  (90950fbb)
2020-02-07T14:14:17.6615810+00:00  [INF] SetOrderStatusToStockConfirmedCommand sent  (74dba639)
2020-02-07T14:14:27.1900874+00:00 0HLTBQSNIR4JI:00000007 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c   (ca22a1cb)
2020-02-07T14:14:27.1984542+00:00 0HLTBQSNIR4JI:00000007 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T14:14:27.2054535+00:00 0HLTBQSNIR4JI:00000007 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T14:14:27.2106137+00:00 0HLTBQSNIR4JI:00000007 [INF] Request finished in 22.1459ms 204  (791a596a)
2020-02-07T14:14:27.2398426+00:00 0HLTBQSNIR4JI:00000008 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c application/json; charset=utf-8  (ca22a1cb)
2020-02-07T14:14:27.2440529+00:00 0HLTBQSNIR4JI:00000008 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T14:14:27.2580192+00:00 0HLTBQSNIR4JI:00000008 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T14:14:27.2812823+00:00 0HLTBQSNIR4JI:00000008 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (500cc934)
2020-02-07T14:14:27.2873526+00:00 0HLTBQSNIR4JI:00000008 [INF] Route matched with "{action = \"GetLatestOrderForUser\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetLatestOrderForUser(System.String)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T14:14:27.2930675+00:00 0HLTBQSNIR4JI:00000008 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T14:14:27.3494575+00:00 0HLTBQSNIR4JI:00000008 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 50.2073ms. (50a9e262)
2020-02-07T14:14:27.3568819+00:00 0HLTBQSNIR4JI:00000008 [INF] Executing ObjectResult, writing value of type '"System.String"'. (8a1b66c8)
2020-02-07T14:14:27.3654857+00:00 0HLTBQSNIR4JI:00000008 [INF] Executed action "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" in 70.7067ms (afa2e885)
2020-02-07T14:14:27.3696309+00:00 0HLTBQSNIR4JI:00000008 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (99874f2b)
2020-02-07T14:14:27.3730514+00:00 0HLTBQSNIR4JI:00000008 [INF] Request finished in 141.8573ms 200 application/json; charset=utf-8 (791a596a)
2020-02-07T14:15:03.2160078+00:00  [INF] Inside UserCheckoutIntegrationEvent handler (3529aed2)
2020-02-07T14:15:03.2327559+00:00  [INF] CreateOrderCommand created CreateOrderCommand { OrderItems: [OrderItemDto { ProductId: 18, ProductName: "لپ تاپ 15 اینچی لنوو مدل Ideapad V330- A", Quantity: 1, UnitPrice: 10230000.0, Discount: 0 }], UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", City: "تهران", State: "تهران", Country: "ایران", Street: "آذربایجان", ZipCode: "123456" } (3fd9f466)
2020-02-07T14:15:03.2391621+00:00  [INF] Order instantiated Order { OrderDate: 02/07/2020 14:15:03, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 14:15:03, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 14:15:03, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: null, Address: null, BuyerId: null, OrderState: null, OrderItems: null, Id: null, DomainEvents: null }, Id: 3fc71016-d67f-4965-8306-72f3091a571e, CreationDate: 02/07/2020 14:15:03 }] }, Id: 3fc71016-d67f-4965-8306-72f3091a571e, CreationDate: 02/07/2020 14:15:03 }] }, Id: 3fc71016-d67f-4965-8306-72f3091a571e, CreationDate: 02/07/2020 14:15:03 }] } (2c6718b0)
2020-02-07T14:15:03.2502901+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T14:15:03.3325561+00:00  [INF] Executed DbCommand ("21"ms) [Parameters=["@__buyerIdentityGuid_0='?' (Size = 450)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(2) [e].[Id], [e].[IdentityGuid], [e].[Name]
FROM [Buyers] AS [e]
WHERE [e].[IdentityGuid] = @__buyerIdentityGuid_0" (0723d8ff)
2020-02-07T14:15:03.3790948+00:00  [INF] BuyerCreatedDomainEvent added to list of buyer events (70d1b556)
2020-02-07T14:15:03.4696898+00:00  [INF] Executed DbCommand ("4"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T14:15:03.5212208+00:00  [INF] order retrieved to set its buyer Order { OrderDate: 02/07/2020 14:15:03, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 10230000.0, ProductId: 18, ProductName: "لپ تاپ 15 اینچی لنوو مدل Ideapad V330- A", Discount: 0, PictureUri: null, Id: 5, DomainEvents: null }], Id: 5, DomainEvents: [] } (eee39e3d)
2020-02-07T14:15:03.5258201+00:00  [INF] orderId is 5 (6360224c)
2020-02-07T14:15:03.5543238+00:00  [INF] buyerId set to 1 (b0efb381)
2020-02-07T14:15:03.5652210+00:00  [INF] OrderStatus is set to SetAwaitingValidationStatus  (8d340758)
2020-02-07T14:15:03.6021315+00:00  [INF] OrderStatusChangedToAwaitingValidationDomainEvent handler called (622cbd86)
2020-02-07T14:15:03.6087899+00:00  [INF] OrderId is 5 (9c7ce781)
2020-02-07T14:15:03.6167399+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is created OrderStatusChangedToAwaitingValidationIntegrationEvent { StockItems: [StockItem { ProductId: 18, Units: 1 }], OrderId: 5, Id: 00000000-0000-0000-0000-000000000000, CreationDate: 02/07/2020 14:15:03 } (ff364eea)
2020-02-07T14:15:03.6866398+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is published (5de65a50)
2020-02-07T14:15:03.7325937+00:00  [INF] Executed DbCommand ("24"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (0723d8ff)
2020-02-07T14:15:03.7894819+00:00  [INF] Executed DbCommand ("4"ms) [Parameters=["@p10='?' (DbType = Int32), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (Size = 4000), @p16='?' (DbType = Int32), @p17='?' (DbType = Decimal)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [OrderItems] ([Id], [Discount], [OrderId], [PictureUri], [ProductId], [ProductName], [Quantity], [UnitPrice])
VALUES (@p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);" (0723d8ff)
2020-02-07T14:15:03.7899091+00:00  [INF] SetOrderStatusToStockConfirmedCommand created:SetOrderStatusToStockConfirmedCommand { orderId: 5 }  (5429d522)
2020-02-07T14:15:03.7988098+00:00  [INF] Order will be retrieved with Id= 5 (535d6bce)
2020-02-07T14:15:03.8099193+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T14:15:03.8173601+00:00  [INF] SaveChanges called on buyer (3505242c)
2020-02-07T14:15:03.8300932+00:00  [INF] Order SaveChanges finished (85d05615)
2020-02-07T14:15:03.8551679+00:00  [INF] CreateOrderCommand sent (8a728658)
2020-02-07T14:15:03.8666768+00:00  [INF] Executed DbCommand ("4"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T14:15:03.9304273+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T14:15:03.9674448+00:00  [INF] Order retrieved Order { OrderDate: 02/07/2020 14:15:03, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: 1, OrderState: AwaitingValidation, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 10230000.00, ProductId: 18, ProductName: "لپ تاپ 15 اینچی لنوو مدل Ideapad V330- A", Discount: 0.00, PictureUri: null, Id: 5, DomainEvents: null }], Id: 5, DomainEvents: null } (6f81d885)
2020-02-07T14:15:03.9738188+00:00  [INF] SetStockConfirmedStatus called on order object (37636d94)
2020-02-07T14:15:04.5449818+00:00  [INF] Executed DbCommand ("4"ms) [Parameters=["@p2='?' (DbType = Int32), @p0='?' (DbType = Int16), @p1='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
UPDATE [Orders] SET [OrderState] = @p0, [Description] = @p1
WHERE [Id] = @p2;
SELECT @@ROWCOUNT;" (0723d8ff)
2020-02-07T14:15:04.5749947+00:00  [INF] SaveChanges finished  (90950fbb)
2020-02-07T14:15:04.5804692+00:00  [INF] SetOrderStatusToStockConfirmedCommand sent  (74dba639)
2020-02-07T14:15:14.4165116+00:00 0HLTBQSNIR4JI:00000009 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c   (ca22a1cb)
2020-02-07T14:15:14.4241586+00:00 0HLTBQSNIR4JI:00000009 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T14:15:14.4298561+00:00 0HLTBQSNIR4JI:00000009 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T14:15:14.4357973+00:00 0HLTBQSNIR4JI:00000009 [INF] Request finished in 19.8638ms 204  (791a596a)
2020-02-07T14:15:14.4776510+00:00 0HLTBQSNIR4JI:0000000A [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c application/json; charset=utf-8  (ca22a1cb)
2020-02-07T14:15:14.4912724+00:00 0HLTBQSNIR4JI:0000000A [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T14:15:14.5034514+00:00 0HLTBQSNIR4JI:0000000A [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T14:15:14.5086129+00:00 0HLTBQSNIR4JI:0000000A [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (500cc934)
2020-02-07T14:15:14.5217873+00:00 0HLTBQSNIR4JI:0000000A [INF] Route matched with "{action = \"GetLatestOrderForUser\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetLatestOrderForUser(System.String)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T14:15:14.5314251+00:00 0HLTBQSNIR4JI:0000000A [INF] Executing action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T14:15:14.6083880+00:00 0HLTBQSNIR4JI:0000000A [INF] Executed action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 67.1534ms. (50a9e262)
2020-02-07T14:15:14.6175404+00:00 0HLTBQSNIR4JI:0000000A [INF] Executing ObjectResult, writing value of type '"System.String"'. (8a1b66c8)
2020-02-07T14:15:14.6241679+00:00 0HLTBQSNIR4JI:0000000A [INF] Executed action "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" in 95.9323ms (afa2e885)
2020-02-07T14:15:14.6323410+00:00 0HLTBQSNIR4JI:0000000A [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (99874f2b)
2020-02-07T14:15:14.6377897+00:00 0HLTBQSNIR4JI:0000000A [INF] Request finished in 193.2617ms 200 application/json; charset=utf-8 (791a596a)
2020-02-07T14:20:12.3745691+00:00 0HLTBQSNIR4JJ:00000001 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/LatestOrderStatus/BuyerId/5c353957-2e04-4814-820b-2bfdf5b6c246   (ca22a1cb)
2020-02-07T14:20:12.3816967+00:00 0HLTBQSNIR4JJ:00000001 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (500cc934)
2020-02-07T14:20:12.3873328+00:00 0HLTBQSNIR4JJ:00000001 [INF] Route matched with "{action = \"GetLatestOrderForUser\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetLatestOrderForUser(System.String)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T14:20:12.4059175+00:00 0HLTBQSNIR4JJ:00000001 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T14:20:12.4601339+00:00 0HLTBQSNIR4JJ:00000001 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 48.2773ms. (50a9e262)
2020-02-07T14:20:12.4956112+00:00 0HLTBQSNIR4JJ:00000001 [INF] Executing ObjectResult, writing value of type '"null"'. (8a1b66c8)
2020-02-07T14:20:12.5010672+00:00 0HLTBQSNIR4JJ:00000001 [INF] Executed action "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" in 108.7124ms (afa2e885)
2020-02-07T14:20:12.5147832+00:00 0HLTBQSNIR4JJ:00000001 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (99874f2b)
2020-02-07T14:20:12.5204371+00:00 0HLTBQSNIR4JJ:00000001 [INF] Request finished in 150.4479ms 204  (791a596a)
2020-02-07T14:21:54.7128954+00:00 0HLTBQSNIR4JK:00000001 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/all?pageSize=5&pageIndex=0   (ca22a1cb)
2020-02-07T14:21:54.7170633+00:00 0HLTBQSNIR4JK:00000001 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T14:21:54.8101886+00:00 0HLTBQSNIR4JK:00000001 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T14:21:54.8636084+00:00 0HLTBQSNIR4JK:00000001 [INF] Request finished in 114.704ms 204  (791a596a)
2020-02-07T14:21:54.8855911+00:00 0HLTBQSNIR4JK:00000002 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/all?pageSize=5&pageIndex=0 application/json; charset=utf-8  (ca22a1cb)
2020-02-07T14:21:54.9025756+00:00 0HLTBQSNIR4JK:00000002 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T14:21:54.9285086+00:00 0HLTBQSNIR4JK:00000002 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T14:21:54.9526863+00:00 0HLTBQSNIR4JK:00000002 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetAll (Ordering.API)"' (500cc934)
2020-02-07T14:21:54.9628078+00:00 0HLTBQSNIR4JK:00000002 [INF] Route matched with "{action = \"GetAll\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetAll(Int32, Int32)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T14:21:54.9831654+00:00 0HLTBQSNIR4JK:00000002 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T14:21:55.0655253+00:00 0HLTBQSNIR4JK:00000002 [INF] GetAll action inside Order Controller (ed7fa128)
2020-02-07T14:21:55.0890667+00:00 0HLTBQSNIR4JK:00000002 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 82.4644ms. (50a9e262)
2020-02-07T14:21:55.0935160+00:00 0HLTBQSNIR4JK:00000002 [INF] Executing ObjectResult, writing value of type '"Ordering.QueryModel.ViewModels.PagedResult`1[[Ordering.QueryModel.ViewModels.OrderSummeryViewModel, Ordering.QueryModel, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]"'. (8a1b66c8)
2020-02-07T14:21:55.1682356+00:00 0HLTBQSNIR4JK:00000002 [INF] Executed action "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)" in 186.8375ms (afa2e885)
2020-02-07T14:21:55.1781734+00:00 0HLTBQSNIR4JK:00000002 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetAll (Ordering.API)"' (99874f2b)
2020-02-07T14:21:55.2035307+00:00 0HLTBQSNIR4JK:00000002 [INF] Request finished in 329.4772ms 200 application/json; charset=utf-8 (791a596a)
2020-02-07T14:43:33.2583547+00:00  [INF] Inside UserCheckoutIntegrationEvent handler (3529aed2)
2020-02-07T14:43:33.2644590+00:00  [INF] CreateOrderCommand created CreateOrderCommand { OrderItems: [OrderItemDto { ProductId: 20, ProductName: "ماوس گرین GM-101", Quantity: 1, UnitPrice: 85000.0, Discount: 0 }], UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", City: "تهران", State: "تهران", Country: "ایران", Street: "آذربایجان", ZipCode: "123456" } (3fd9f466)
2020-02-07T14:43:33.2752354+00:00  [INF] Order instantiated Order { OrderDate: 02/07/2020 14:43:33, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 14:43:33, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 14:43:33, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: null, Address: null, BuyerId: null, OrderState: null, OrderItems: null, Id: null, DomainEvents: null }, Id: 1f6d511d-9fcd-45ac-9eb7-16861c3260df, CreationDate: 02/07/2020 14:43:33 }] }, Id: 1f6d511d-9fcd-45ac-9eb7-16861c3260df, CreationDate: 02/07/2020 14:43:33 }] }, Id: 1f6d511d-9fcd-45ac-9eb7-16861c3260df, CreationDate: 02/07/2020 14:43:33 }] } (2c6718b0)
2020-02-07T14:43:33.3031832+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T14:43:33.6391571+00:00  [INF] Executed DbCommand ("42"ms) [Parameters=["@__buyerIdentityGuid_0='?' (Size = 450)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(2) [e].[Id], [e].[IdentityGuid], [e].[Name]
FROM [Buyers] AS [e]
WHERE [e].[IdentityGuid] = @__buyerIdentityGuid_0" (0723d8ff)
2020-02-07T14:43:33.6703001+00:00  [INF] BuyerCreatedDomainEvent added to list of buyer events (70d1b556)
2020-02-07T14:43:33.7155759+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T14:43:33.7261973+00:00  [INF] order retrieved to set its buyer Order { OrderDate: 02/07/2020 14:43:33, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 85000.0, ProductId: 20, ProductName: "ماوس گرین GM-101", Discount: 0, PictureUri: null, Id: 6, DomainEvents: null }], Id: 6, DomainEvents: [] } (eee39e3d)
2020-02-07T14:43:33.7332651+00:00  [INF] orderId is 6 (6360224c)
2020-02-07T14:43:33.7610777+00:00  [INF] buyerId set to 1 (b0efb381)
2020-02-07T14:43:33.7664234+00:00  [INF] OrderStatus is set to SetAwaitingValidationStatus  (8d340758)
2020-02-07T14:43:35.7711850+00:00  [INF] OrderStatusChangedToAwaitingValidationDomainEvent handler called (622cbd86)
2020-02-07T14:43:35.7882430+00:00  [INF] OrderId is 6 (9c7ce781)
2020-02-07T14:43:35.7935521+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is created OrderStatusChangedToAwaitingValidationIntegrationEvent { StockItems: [StockItem { ProductId: 20, Units: 1 }], OrderId: 6, Id: 00000000-0000-0000-0000-000000000000, CreationDate: 02/07/2020 14:43:35 } (ff364eea)
2020-02-07T14:43:35.9611465+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is published (5de65a50)
2020-02-07T14:43:36.0089086+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (0723d8ff)
2020-02-07T14:43:36.0236452+00:00  [INF] Executed DbCommand ("8"ms) [Parameters=["@p10='?' (DbType = Int32), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (Size = 4000), @p16='?' (DbType = Int32), @p17='?' (DbType = Decimal)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [OrderItems] ([Id], [Discount], [OrderId], [PictureUri], [ProductId], [ProductName], [Quantity], [UnitPrice])
VALUES (@p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);" (0723d8ff)
2020-02-07T14:43:36.0857606+00:00  [INF] SetOrderStatusToStockRejectedCommand created { @cmd} (e9c5261c)
2020-02-07T14:43:36.0891058+00:00  [INF] SaveChanges called on buyer (3505242c)
2020-02-07T14:43:36.1540848+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T14:43:36.1591673+00:00  [INF] Order SaveChanges finished (85d05615)
2020-02-07T14:43:36.1840414+00:00  [INF] CreateOrderCommand sent (8a728658)
2020-02-07T14:43:36.1882667+00:00  [INF] Executed DbCommand ("3"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T14:43:36.2376014+00:00  [INF] Executed DbCommand ("7"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T14:43:36.2474353+00:00  [INF] order retrieved to be set as rejected. Ordering.Domain.AggregatesModel.OrderAggregate.Order (bfe0f450)
2020-02-07T14:43:36.2533091+00:00  [INF] order status changed to rejected (7df0448d)
2020-02-07T14:43:36.3351999+00:00  [INF] Executed DbCommand ("3"ms) [Parameters=["@p2='?' (DbType = Int32), @p0='?' (DbType = Int16), @p1='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
UPDATE [Orders] SET [OrderState] = @p0, [Description] = @p1
WHERE [Id] = @p2;
SELECT @@ROWCOUNT;" (0723d8ff)
2020-02-07T14:43:36.3648853+00:00  [INF] SaveChanges called for order (877d402b)
2020-02-07T14:43:36.3918323+00:00  [INF] SetOrderStatusToStockRejectedCommand sent (02d4de29)
2020-02-07T14:43:44.4782748+00:00 0HLTBQSNIR4JL:00000001 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c   (ca22a1cb)
2020-02-07T14:43:44.4841502+00:00 0HLTBQSNIR4JL:00000001 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T14:43:44.4926768+00:00 0HLTBQSNIR4JL:00000001 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T14:43:44.5228359+00:00 0HLTBQSNIR4JL:00000001 [INF] Request finished in 36.3648ms 204  (791a596a)
2020-02-07T14:43:44.5292779+00:00 0HLTBQSNIR4JL:00000002 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c application/json; charset=utf-8  (ca22a1cb)
2020-02-07T14:43:44.5364056+00:00 0HLTBQSNIR4JL:00000002 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T14:43:44.5467237+00:00 0HLTBQSNIR4JL:00000002 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T14:43:44.5512798+00:00 0HLTBQSNIR4JL:00000002 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (500cc934)
2020-02-07T14:43:44.5584646+00:00 0HLTBQSNIR4JL:00000002 [INF] Route matched with "{action = \"GetLatestOrderForUser\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetLatestOrderForUser(System.String)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T14:43:44.5690442+00:00 0HLTBQSNIR4JL:00000002 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T14:43:44.5768945+00:00 0HLTBQSNIR4JL:00000002 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 3.4251ms. (50a9e262)
2020-02-07T14:43:44.5944851+00:00 0HLTBQSNIR4JL:00000002 [INF] Executing ObjectResult, writing value of type '"System.String"'. (8a1b66c8)
2020-02-07T14:43:44.5990947+00:00 0HLTBQSNIR4JL:00000002 [INF] Executed action "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" in 36.4036ms (afa2e885)
2020-02-07T14:43:44.6039448+00:00 0HLTBQSNIR4JL:00000002 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (99874f2b)
2020-02-07T14:43:44.6275217+00:00 0HLTBQSNIR4JL:00000002 [INF] Request finished in 79.719ms 200 application/json; charset=utf-8 (791a596a)
2020-02-07T18:42:32.5366180+00:00  [INF] Timed Hosted Service running. (e41a204c)
2020-02-07T18:47:26.6279909+00:00  [INF] Timed Hosted Service running. (e41a204c)
2020-02-07T18:47:49.7860292+00:00 0HLTBVOTC3V1G:00000001 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/all?pageSize=5&pageIndex=0   (ca22a1cb)
2020-02-07T18:47:49.8778409+00:00 0HLTBVOTC3V1G:00000001 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:47:49.8873856+00:00 0HLTBVOTC3V1G:00000001 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:47:49.9653022+00:00 0HLTBVOTC3V1G:00000001 [INF] Request finished in 173.037ms 204  (791a596a)
2020-02-07T18:47:49.9911537+00:00 0HLTBVOTC3V1G:00000002 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/all?pageSize=5&pageIndex=0 application/json; charset=utf-8  (ca22a1cb)
2020-02-07T18:47:49.9968966+00:00 0HLTBVOTC3V1G:00000002 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:47:50.0113117+00:00 0HLTBVOTC3V1G:00000002 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:47:50.9314725+00:00 0HLTBVOTC3V1G:00000002 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetAll (Ordering.API)"' (500cc934)
2020-02-07T18:47:51.0284220+00:00 0HLTBVOTC3V1G:00000002 [INF] Route matched with "{action = \"GetAll\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetAll(Int32, Int32)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T18:47:51.3744883+00:00 0HLTBVOTC3V1G:00000002 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T18:47:54.0888186+00:00 0HLTBVOTC3V1G:00000002 [INF] GetAll action inside Order Controller (ed7fa128)
2020-02-07T18:47:54.1217489+00:00 0HLTBVOTC3V1G:00000002 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 2730.9013ms. (50a9e262)
2020-02-07T18:47:54.1978073+00:00 0HLTBVOTC3V1G:00000002 [INF] Executing ObjectResult, writing value of type '"Ordering.QueryModel.ViewModels.PagedResult`1[[Ordering.QueryModel.ViewModels.OrderSummeryViewModel, Ordering.QueryModel, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]"'. (8a1b66c8)
2020-02-07T18:47:55.0687518+00:00 0HLTBVOTC3V1G:00000002 [INF] Executed action "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)" in 4019.2378ms (afa2e885)
2020-02-07T18:47:55.0965069+00:00 0HLTBVOTC3V1G:00000002 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetAll (Ordering.API)"' (99874f2b)
2020-02-07T18:47:55.1759347+00:00 0HLTBVOTC3V1G:00000002 [INF] Request finished in 5182.6159ms 200 application/json; charset=utf-8 (791a596a)
2020-02-07T18:48:01.7318944+00:00  [INF] Inside UserCheckoutIntegrationEvent handler (3529aed2)
2020-02-07T18:48:01.8288491+00:00  [INF] CreateOrderCommand created CreateOrderCommand { OrderItems: [OrderItemDto { ProductId: 12, ProductName: "لپ تاپ 15 اینچی اچ پی مدل ENVY X360 15T CN100 - B", Quantity: 1, UnitPrice: 50000000.0, Discount: 0 }], UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", City: "تهران", State: "تهران", Country: "ایران", Street: "آذربایجان", ZipCode: "123456" } (3fd9f466)
2020-02-07T18:48:02.1836596+00:00  [INF] Order instantiated Order { OrderDate: 02/07/2020 18:48:02, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 18:48:02, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 18:48:02, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: null, Address: null, BuyerId: null, OrderState: null, OrderItems: null, Id: null, DomainEvents: null }, Id: 29fa74e3-2ffb-4859-bf7a-6ee0bf3fa45d, CreationDate: 02/07/2020 18:48:02 }] }, Id: 29fa74e3-2ffb-4859-bf7a-6ee0bf3fa45d, CreationDate: 02/07/2020 18:48:02 }] }, Id: 29fa74e3-2ffb-4859-bf7a-6ee0bf3fa45d, CreationDate: 02/07/2020 18:48:02 }] } (2c6718b0)
2020-02-07T18:48:02.9091622+00:00  [WRN] No type was specified for the decimal column '"Discount"' on entity type '"OrderItem"'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values using 'HasColumnType()'. (3a0db05f)
2020-02-07T18:48:02.9318777+00:00  [WRN] No type was specified for the decimal column '"UnitPrice"' on entity type '"OrderItem"'. This will cause values to be silently truncated if they do not fit in the default precision and scale. Explicitly specify the SQL server column type that can accommodate all the values using 'HasColumnType()'. (3a0db05f)
2020-02-07T18:48:02.9692184+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T18:48:03.4069885+00:00  [INF] Executed DbCommand ("3"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT NEXT VALUE FOR [orderseq]" (0723d8ff)
2020-02-07T18:48:04.2392465+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT NEXT VALUE FOR [orderitemseq]" (0723d8ff)
2020-02-07T18:48:05.8579500+00:00  [INF] Executed DbCommand ("1"ms) [Parameters=["@__buyerIdentityGuid_0='?' (Size = 450)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(2) [e].[Id], [e].[IdentityGuid], [e].[Name]
FROM [Buyers] AS [e]
WHERE [e].[IdentityGuid] = @__buyerIdentityGuid_0" (0723d8ff)
2020-02-07T18:48:05.9508727+00:00  [INF] BuyerCreatedDomainEvent added to list of buyer events (70d1b556)
2020-02-07T18:48:06.1877817+00:00  [INF] Executed DbCommand ("23"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T18:48:06.2448476+00:00  [INF] order retrieved to set its buyer Order { OrderDate: 02/07/2020 18:48:02, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 50000000.0, ProductId: 12, ProductName: "لپ تاپ 15 اینچی اچ پی مدل ENVY X360 15T CN100 - B", Discount: 0, PictureUri: null, Id: 3, DomainEvents: null }], Id: 3, DomainEvents: [] } (eee39e3d)
2020-02-07T18:48:06.2514063+00:00  [INF] orderId is 3 (6360224c)
2020-02-07T18:48:06.2750059+00:00  [INF] buyerId set to 1 (b0efb381)
2020-02-07T18:48:06.2814293+00:00  [INF] OrderStatus is set to SetAwaitingValidationStatus  (8d340758)
2020-02-07T18:48:06.3183141+00:00  [INF] OrderStatusChangedToAwaitingValidationDomainEvent handler called (622cbd86)
2020-02-07T18:48:06.3407725+00:00  [INF] OrderId is 3 (9c7ce781)
2020-02-07T18:48:06.3510260+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is created OrderStatusChangedToAwaitingValidationIntegrationEvent { StockItems: [StockItem { ProductId: 12, Units: 1 }], OrderId: 3, Id: 00000000-0000-0000-0000-000000000000, CreationDate: 02/07/2020 18:48:06 } (ff364eea)
2020-02-07T18:48:06.5234340+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is published (5de65a50)
2020-02-07T18:48:06.5574026+00:00  [INF] Executed DbCommand ("1"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (0723d8ff)
2020-02-07T18:48:06.7831507+00:00  [INF] SetOrderStatusToStockConfirmedCommand created:SetOrderStatusToStockConfirmedCommand { orderId: 3 }  (5429d522)
2020-02-07T18:48:06.8638727+00:00  [INF] Order will be retrieved with Id= 3 (535d6bce)
2020-02-07T18:48:06.8920103+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T18:48:06.9477403+00:00  [ERR] Failed executing DbCommand ("155"ms) [Parameters=["@p10='?' (DbType = Int32), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (Size = 4000), @p16='?' (DbType = Int32), @p17='?' (DbType = Decimal)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [OrderItems] ([Id], [Discount], [OrderId], [PictureUri], [ProductId], [ProductName], [Quantity], [UnitPrice])
VALUES (@p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
ClientConnectionId:13789510-06fe-465b-8902-593aea2d8ed0
Error Number:2627,State:1,Class:14
2020-02-07T18:48:07.1207883+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2020-02-07T18:48:10.0362950+00:00  [INF] Executed DbCommand ("3"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (0723d8ff)
2020-02-07T18:48:10.0758478+00:00  [ERR] Failed executing DbCommand ("6"ms) [Parameters=["@p10='?' (DbType = Int32), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (Size = 4000), @p16='?' (DbType = Int32), @p17='?' (DbType = Decimal)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [OrderItems] ([Id], [Discount], [OrderId], [PictureUri], [ProductId], [ProductName], [Quantity], [UnitPrice])
VALUES (@p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:13789510-06fe-465b-8902-593aea2d8ed0
Error Number:2627,State:1,Class:14
2020-02-07T18:48:10.1251725+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2020-02-07T18:48:11.0902251+00:00  [INF] SaveChanges called on buyer (3505242c)
2020-02-07T18:48:11.1398220+00:00  [INF] Executed DbCommand ("12"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (0723d8ff)
2020-02-07T18:48:11.2628830+00:00  [ERR] Failed executing DbCommand ("89"ms) [Parameters=["@p10='?' (DbType = Int32), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (Size = 4000), @p16='?' (DbType = Int32), @p17='?' (DbType = Decimal)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [OrderItems] ([Id], [Discount], [OrderId], [PictureUri], [ProductId], [ProductName], [Quantity], [UnitPrice])
VALUES (@p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:13789510-06fe-465b-8902-593aea2d8ed0
Error Number:2627,State:1,Class:14
2020-02-07T18:48:11.3801481+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_OrderItems'. Cannot insert duplicate key in object 'dbo.OrderItems'. The duplicate key value is (3).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T18:48:12.3250582+00:00  [INF] Order SaveChanges finished (85d05615)
2020-02-07T18:48:12.3552484+00:00 0HLTBVOTC3V1G:00000003 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c   (ca22a1cb)
2020-02-07T18:48:12.3777637+00:00 0HLTBVOTC3V1G:00000003 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:48:12.3823065+00:00 0HLTBVOTC3V1G:00000003 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:48:12.3952956+00:00 0HLTBVOTC3V1G:00000003 [INF] Request finished in 60.0202ms 204  (791a596a)
2020-02-07T18:48:12.5378194+00:00  [INF] CreateOrderCommand sent (8a728658)
2020-02-07T18:48:12.5620775+00:00 0HLTBVOTC3V1G:00000004 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c application/json; charset=utf-8  (ca22a1cb)
2020-02-07T18:48:12.5724456+00:00 0HLTBVOTC3V1G:00000004 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:48:12.5910879+00:00 0HLTBVOTC3V1G:00000004 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:48:12.6305949+00:00 0HLTBVOTC3V1G:00000004 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (500cc934)
2020-02-07T18:48:12.6648723+00:00 0HLTBVOTC3V1G:00000004 [INF] Route matched with "{action = \"GetLatestOrderForUser\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetLatestOrderForUser(System.String)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T18:48:12.6799343+00:00 0HLTBVOTC3V1G:00000004 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T18:48:12.7314355+00:00  [INF] Executed DbCommand ("1"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T18:48:12.7992723+00:00 0HLTBVOTC3V1G:00000004 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 112.2119ms. (50a9e262)
2020-02-07T18:48:12.8130256+00:00 0HLTBVOTC3V1G:00000004 [INF] Executing ObjectResult, writing value of type '"System.String"'. (8a1b66c8)
2020-02-07T18:48:12.8220887+00:00 0HLTBVOTC3V1G:00000004 [INF] Executed action "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" in 148.5472ms (afa2e885)
2020-02-07T18:48:12.8260750+00:00 0HLTBVOTC3V1G:00000004 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (99874f2b)
2020-02-07T18:48:12.8374801+00:00 0HLTBVOTC3V1G:00000004 [INF] Request finished in 287.2779ms 200 application/json; charset=utf-8 (791a596a)
2020-02-07T18:48:12.8472987+00:00  [INF] retry for 0 (fe099784)
2020-02-07T18:48:13.8767264+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T18:48:13.8913257+00:00  [INF] retry for 1 (fe099784)
2020-02-07T18:48:14.9261519+00:00  [INF] Executed DbCommand ("24"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T18:48:14.9581994+00:00  [INF] retry for 2 (fe099784)
2020-02-07T18:48:15.9700330+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T18:48:15.9834505+00:00  [INF] retry for 3 (fe099784)
2020-02-07T18:48:17.0094102+00:00  [INF] Executed DbCommand ("1"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T18:48:17.0445585+00:00  [INF] retry for 4 (fe099784)
2020-02-07T18:48:18.1243447+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T18:48:18.1417123+00:00  [INF] Order retrieved "(null)" (6f81d885)
2020-02-07T18:48:18.2026321+00:00  [INF] SetOrderStatusToStockConfirmedCommand sent  (74dba639)
2020-02-07T18:48:29.4414777+00:00  [INF] Inside UserCheckoutIntegrationEvent handler (3529aed2)
2020-02-07T18:48:29.4491837+00:00  [INF] CreateOrderCommand created CreateOrderCommand { OrderItems: [OrderItemDto { ProductId: 2, ProductName: "گوشی موبایل ال جی مدل V30 Plus", Quantity: 1, UnitPrice: 1505800.0, Discount: 0 }], UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", City: "تهران", State: "تهران", Country: "ایران", Street: "آذربایجان", ZipCode: "123456" } (3fd9f466)
2020-02-07T18:48:29.4824184+00:00  [INF] Order instantiated Order { OrderDate: 02/07/2020 18:48:29, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 18:48:29, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 18:48:29, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: null, Address: null, BuyerId: null, OrderState: null, OrderItems: null, Id: null, DomainEvents: null }, Id: b6e93bd3-0012-4a8c-84c2-04554223ea10, CreationDate: 02/07/2020 18:48:29 }] }, Id: b6e93bd3-0012-4a8c-84c2-04554223ea10, CreationDate: 02/07/2020 18:48:29 }] }, Id: b6e93bd3-0012-4a8c-84c2-04554223ea10, CreationDate: 02/07/2020 18:48:29 }] } (2c6718b0)
2020-02-07T18:48:29.5345666+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T18:48:29.5660545+00:00  [INF] Executed DbCommand ("10"ms) [Parameters=["@__buyerIdentityGuid_0='?' (Size = 450)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(2) [e].[Id], [e].[IdentityGuid], [e].[Name]
FROM [Buyers] AS [e]
WHERE [e].[IdentityGuid] = @__buyerIdentityGuid_0" (0723d8ff)
2020-02-07T18:48:29.6207484+00:00  [INF] BuyerCreatedDomainEvent added to list of buyer events (70d1b556)
2020-02-07T18:48:29.7404171+00:00  [INF] Executed DbCommand ("5"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T18:48:29.7985583+00:00  [INF] order retrieved to set its buyer Order { OrderDate: 02/07/2020 18:48:29, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 1505800.0, ProductId: 2, ProductName: "گوشی موبایل ال جی مدل V30 Plus", Discount: 0, PictureUri: null, Id: 4, DomainEvents: null }], Id: 4, DomainEvents: [] } (eee39e3d)
2020-02-07T18:48:29.8080969+00:00  [INF] orderId is 4 (6360224c)
2020-02-07T18:48:29.8152723+00:00  [INF] buyerId set to 1 (b0efb381)
2020-02-07T18:48:29.8205505+00:00  [INF] OrderStatus is set to SetAwaitingValidationStatus  (8d340758)
2020-02-07T18:48:29.8831863+00:00  [INF] OrderStatusChangedToAwaitingValidationDomainEvent handler called (622cbd86)
2020-02-07T18:48:29.8889261+00:00  [INF] OrderId is 4 (9c7ce781)
2020-02-07T18:48:29.8954480+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is created OrderStatusChangedToAwaitingValidationIntegrationEvent { StockItems: [StockItem { ProductId: 2, Units: 1 }], OrderId: 4, Id: 00000000-0000-0000-0000-000000000000, CreationDate: 02/07/2020 18:48:29 } (ff364eea)
2020-02-07T18:48:30.0932110+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is published (5de65a50)
2020-02-07T18:48:30.1660546+00:00  [ERR] Failed executing DbCommand ("16"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (4).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:13789510-06fe-465b-8902-593aea2d8ed0
Error Number:2627,State:1,Class:14
2020-02-07T18:48:30.2100419+00:00  [INF] SetOrderStatusToStockConfirmedCommand created:SetOrderStatusToStockConfirmedCommand { orderId: 4 }  (5429d522)
2020-02-07T18:48:30.2151967+00:00  [INF] Order will be retrieved with Id= 4 (535d6bce)
2020-02-07T18:48:30.2224796+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T18:48:30.2914409+00:00  [INF] Executed DbCommand ("22"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T18:48:30.3944089+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (4).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (4).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T18:48:31.4539747+00:00  [INF] Executed DbCommand ("13"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T18:48:31.4815563+00:00  [INF] Order retrieved Order { OrderDate: 02/07/2020 14:14:15, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: 1, OrderState: StockConfirmed, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 95500.00, ProductId: 22, ProductName: "هدفون بی سیم نیا مدل Q8-851S", Discount: 0.00, PictureUri: null, Id: 4, DomainEvents: null }], Id: 4, DomainEvents: null } (6f81d885)
2020-02-07T18:48:31.4905749+00:00  [INF] SetStockConfirmedStatus called on order object (37636d94)
2020-02-07T18:48:31.5002586+00:00  [INF] SaveChanges finished  (90950fbb)
2020-02-07T18:48:31.5075345+00:00  [INF] SetOrderStatusToStockConfirmedCommand sent  (74dba639)
2020-02-07T18:48:31.5349846+00:00  [ERR] Failed executing DbCommand ("4"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (4).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
ClientConnectionId:9f0eaed1-b657-4621-b493-cc2202a6b719
Error Number:2627,State:1,Class:14
2020-02-07T18:48:31.5662543+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (4).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (4).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T18:48:32.6369255+00:00  [INF] SaveChanges called on buyer (3505242c)
2020-02-07T18:48:32.6812920+00:00  [ERR] Failed executing DbCommand ("15"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (4).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9f0eaed1-b657-4621-b493-cc2202a6b719
Error Number:2627,State:1,Class:14
2020-02-07T18:48:32.7884155+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (4).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (4).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T18:48:33.7459471+00:00  [INF] Order SaveChanges finished (85d05615)
2020-02-07T18:48:33.7749233+00:00  [INF] CreateOrderCommand sent (8a728658)
2020-02-07T18:48:41.5913506+00:00 0HLTBVOTC3V1G:00000005 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c   (ca22a1cb)
2020-02-07T18:48:41.5966200+00:00 0HLTBVOTC3V1G:00000005 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:48:41.6284091+00:00 0HLTBVOTC3V1G:00000005 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:48:41.6329576+00:00 0HLTBVOTC3V1G:00000005 [INF] Request finished in 46.071ms 204  (791a596a)
2020-02-07T18:48:41.6446698+00:00 0HLTBVOTC3V1G:00000006 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c application/json; charset=utf-8  (ca22a1cb)
2020-02-07T18:48:41.6497420+00:00 0HLTBVOTC3V1G:00000006 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:48:41.6556485+00:00 0HLTBVOTC3V1G:00000006 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:48:41.6621741+00:00 0HLTBVOTC3V1G:00000006 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (500cc934)
2020-02-07T18:48:41.6722117+00:00 0HLTBVOTC3V1G:00000006 [INF] Route matched with "{action = \"GetLatestOrderForUser\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetLatestOrderForUser(System.String)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T18:48:41.6775095+00:00 0HLTBVOTC3V1G:00000006 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T18:48:41.7293317+00:00 0HLTBVOTC3V1G:00000006 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 42.5791ms. (50a9e262)
2020-02-07T18:48:41.7341189+00:00 0HLTBVOTC3V1G:00000006 [INF] Executing ObjectResult, writing value of type '"System.String"'. (8a1b66c8)
2020-02-07T18:48:41.7427474+00:00 0HLTBVOTC3V1G:00000006 [INF] Executed action "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" in 62.2975ms (afa2e885)
2020-02-07T18:48:41.7493742+00:00 0HLTBVOTC3V1G:00000006 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (99874f2b)
2020-02-07T18:48:41.7562631+00:00 0HLTBVOTC3V1G:00000006 [INF] Request finished in 110.0823ms 200 application/json; charset=utf-8 (791a596a)
2020-02-07T18:49:04.3535702+00:00  [INF] Inside UserCheckoutIntegrationEvent handler (3529aed2)
2020-02-07T18:49:04.3636222+00:00  [INF] CreateOrderCommand created CreateOrderCommand { OrderItems: [OrderItemDto { ProductId: 22, ProductName: "هدفون بی سیم نیا مدل Q8-851S", Quantity: 1, UnitPrice: 95500.0, Discount: 0 }], UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", City: "تهران", State: "تهران", Country: "ایران", Street: "آذربایجان", ZipCode: "123456" } (3fd9f466)
2020-02-07T18:49:04.3925468+00:00  [INF] Order instantiated Order { OrderDate: 02/07/2020 18:49:04, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 18:49:04, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 18:49:04, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: null, Address: null, BuyerId: null, OrderState: null, OrderItems: null, Id: null, DomainEvents: null }, Id: 412e56a4-0887-44da-9b7a-b2121b4af21b, CreationDate: 02/07/2020 18:49:04 }] }, Id: 412e56a4-0887-44da-9b7a-b2121b4af21b, CreationDate: 02/07/2020 18:49:04 }] }, Id: 412e56a4-0887-44da-9b7a-b2121b4af21b, CreationDate: 02/07/2020 18:49:04 }] } (2c6718b0)
2020-02-07T18:49:04.4023652+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T18:49:04.4434940+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=["@__buyerIdentityGuid_0='?' (Size = 450)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(2) [e].[Id], [e].[IdentityGuid], [e].[Name]
FROM [Buyers] AS [e]
WHERE [e].[IdentityGuid] = @__buyerIdentityGuid_0" (0723d8ff)
2020-02-07T18:49:04.4782987+00:00  [INF] BuyerCreatedDomainEvent added to list of buyer events (70d1b556)
2020-02-07T18:49:04.5606687+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T18:49:04.6952302+00:00  [INF] order retrieved to set its buyer Order { OrderDate: 02/07/2020 18:49:04, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 95500.0, ProductId: 22, ProductName: "هدفون بی سیم نیا مدل Q8-851S", Discount: 0, PictureUri: null, Id: 5, DomainEvents: null }], Id: 5, DomainEvents: [] } (eee39e3d)
2020-02-07T18:49:04.7231577+00:00  [INF] orderId is 5 (6360224c)
2020-02-07T18:49:04.7309729+00:00  [INF] buyerId set to 1 (b0efb381)
2020-02-07T18:49:04.7392497+00:00  [INF] OrderStatus is set to SetAwaitingValidationStatus  (8d340758)
2020-02-07T18:49:04.7887048+00:00  [INF] OrderStatusChangedToAwaitingValidationDomainEvent handler called (622cbd86)
2020-02-07T18:49:04.7941579+00:00  [INF] OrderId is 5 (9c7ce781)
2020-02-07T18:49:04.8044806+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is created OrderStatusChangedToAwaitingValidationIntegrationEvent { StockItems: [StockItem { ProductId: 22, Units: 1 }], OrderId: 5, Id: 00000000-0000-0000-0000-000000000000, CreationDate: 02/07/2020 18:49:04 } (ff364eea)
2020-02-07T18:49:04.9583482+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is published (5de65a50)
2020-02-07T18:49:05.0242207+00:00  [ERR] Failed executing DbCommand ("24"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (5).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:13789510-06fe-465b-8902-593aea2d8ed0
Error Number:2627,State:1,Class:14
2020-02-07T18:49:05.1562187+00:00  [INF] SetOrderStatusToStockConfirmedCommand created:SetOrderStatusToStockConfirmedCommand { orderId: 5 }  (5429d522)
2020-02-07T18:49:05.1869855+00:00  [INF] Order will be retrieved with Id= 5 (535d6bce)
2020-02-07T18:49:05.1912773+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T18:49:05.1918958+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (5).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (5).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T18:49:06.2858680+00:00  [INF] Executed DbCommand ("41"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T18:49:06.3079051+00:00  [ERR] Failed executing DbCommand ("43"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (5).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:13789510-06fe-465b-8902-593aea2d8ed0
Error Number:2627,State:1,Class:14
2020-02-07T18:49:06.3856503+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (5).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (5).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2020-02-07T18:49:06.4025291+00:00  [INF] Executed DbCommand ("34"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T18:49:06.4108899+00:00  [INF] Order retrieved Order { OrderDate: 02/07/2020 14:15:03, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: 1, OrderState: StockConfirmed, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 10230000.00, ProductId: 18, ProductName: "لپ تاپ 15 اینچی لنوو مدل Ideapad V330- A", Discount: 0.00, PictureUri: null, Id: 5, DomainEvents: null }], Id: 5, DomainEvents: null } (6f81d885)
2020-02-07T18:49:06.4175463+00:00  [INF] SetStockConfirmedStatus called on order object (37636d94)
2020-02-07T18:49:06.9367641+00:00  [INF] SaveChanges finished  (90950fbb)
2020-02-07T18:49:07.4049744+00:00  [INF] SetOrderStatusToStockConfirmedCommand sent  (74dba639)
2020-02-07T18:49:07.4150444+00:00  [INF] SaveChanges called on buyer (3505242c)
2020-02-07T18:49:07.4969303+00:00  [ERR] Failed executing DbCommand ("55"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (5).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:093fa16b-09b0-4449-836e-2a47608860a9
Error Number:2627,State:1,Class:14
2020-02-07T18:49:07.6110468+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (5).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (5).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2020-02-07T18:49:08.6153166+00:00  [INF] Order SaveChanges finished (85d05615)
2020-02-07T18:49:08.6294044+00:00  [INF] CreateOrderCommand sent (8a728658)
2020-02-07T18:49:18.3885975+00:00 0HLTBVOTC3V1G:00000007 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/all?pageSize=5&pageIndex=0   (ca22a1cb)
2020-02-07T18:49:18.3940815+00:00 0HLTBVOTC3V1G:00000007 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:49:18.3997975+00:00 0HLTBVOTC3V1G:00000007 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:49:18.4141670+00:00 0HLTBVOTC3V1G:00000007 [INF] Request finished in 34.2518ms 204  (791a596a)
2020-02-07T18:49:18.4448333+00:00 0HLTBVOTC3V1G:00000008 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/all?pageSize=5&pageIndex=0 application/json; charset=utf-8  (ca22a1cb)
2020-02-07T18:49:18.4568280+00:00 0HLTBVOTC3V1G:00000008 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:49:18.4617814+00:00 0HLTBVOTC3V1G:00000008 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:49:18.4704037+00:00 0HLTBVOTC3V1G:00000008 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetAll (Ordering.API)"' (500cc934)
2020-02-07T18:49:18.4784651+00:00 0HLTBVOTC3V1G:00000008 [INF] Route matched with "{action = \"GetAll\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetAll(Int32, Int32)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T18:49:18.4854364+00:00 0HLTBVOTC3V1G:00000008 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T18:49:18.5666065+00:00 0HLTBVOTC3V1G:00000008 [INF] GetAll action inside Order Controller (ed7fa128)
2020-02-07T18:49:18.5748735+00:00 0HLTBVOTC3V1G:00000008 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 81.2704ms. (50a9e262)
2020-02-07T18:49:18.5974067+00:00 0HLTBVOTC3V1G:00000008 [INF] Executing ObjectResult, writing value of type '"Ordering.QueryModel.ViewModels.PagedResult`1[[Ordering.QueryModel.ViewModels.OrderSummeryViewModel, Ordering.QueryModel, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]"'. (8a1b66c8)
2020-02-07T18:49:18.6293954+00:00 0HLTBVOTC3V1G:00000008 [INF] Executed action "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)" in 139.9961ms (afa2e885)
2020-02-07T18:49:18.6383564+00:00 0HLTBVOTC3V1G:00000008 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetAll (Ordering.API)"' (99874f2b)
2020-02-07T18:49:18.6460207+00:00 0HLTBVOTC3V1G:00000008 [INF] Request finished in 223.8849ms 200 application/json; charset=utf-8 (791a596a)
2020-02-07T18:49:19.0749854+00:00 0HLTBVOTC3V1G:00000009 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c   (ca22a1cb)
2020-02-07T18:49:19.0823222+00:00 0HLTBVOTC3V1G:00000009 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:49:19.0905690+00:00 0HLTBVOTC3V1G:00000009 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:49:19.1205553+00:00 0HLTBVOTC3V1G:00000009 [INF] Request finished in 46.5521ms 204  (791a596a)
2020-02-07T18:49:19.1532439+00:00 0HLTBVOTC3V1G:0000000A [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c application/json; charset=utf-8  (ca22a1cb)
2020-02-07T18:49:19.1602249+00:00 0HLTBVOTC3V1G:0000000A [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:49:19.1664591+00:00 0HLTBVOTC3V1G:0000000A [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:49:19.1948231+00:00 0HLTBVOTC3V1G:0000000A [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (500cc934)
2020-02-07T18:49:19.1992064+00:00 0HLTBVOTC3V1G:0000000A [INF] Route matched with "{action = \"GetLatestOrderForUser\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetLatestOrderForUser(System.String)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T18:49:19.2461730+00:00 0HLTBVOTC3V1G:0000000A [INF] Executing action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T18:49:19.2564751+00:00 0HLTBVOTC3V1G:0000000A [INF] Executed action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 4.3821ms. (50a9e262)
2020-02-07T18:49:19.2624870+00:00 0HLTBVOTC3V1G:0000000A [INF] Executing ObjectResult, writing value of type '"System.String"'. (8a1b66c8)
2020-02-07T18:49:19.2676503+00:00 0HLTBVOTC3V1G:0000000A [INF] Executed action "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" in 63.8279ms (afa2e885)
2020-02-07T18:49:19.2722491+00:00 0HLTBVOTC3V1G:0000000A [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (99874f2b)
2020-02-07T18:49:19.3011911+00:00 0HLTBVOTC3V1G:0000000A [INF] Request finished in 130.1109ms 200 application/json; charset=utf-8 (791a596a)
2020-02-07T18:50:58.6029108+00:00  [INF] Inside UserCheckoutIntegrationEvent handler (3529aed2)
2020-02-07T18:50:58.6099342+00:00  [INF] CreateOrderCommand created CreateOrderCommand { OrderItems: [OrderItemDto { ProductId: 22, ProductName: "هدفون بی سیم نیا مدل Q8-851S", Quantity: 1, UnitPrice: 95500.0, Discount: 0 }, OrderItemDto { ProductId: 23, ProductName: "گوشی موبایل اپل مدل iPhone 11 Pro Max A2220 دو سیم‌ کارت ظرفیت 256 گیگابایت", Quantity: 1, UnitPrice: 21000000.0, Discount: 0 }], UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", City: "تهران", State: "تهران", Country: "ایران", Street: "آذربایجان", ZipCode: "123456" } (3fd9f466)
2020-02-07T18:50:58.6271980+00:00  [INF] Order instantiated Order { OrderDate: 02/07/2020 18:50:58, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 18:50:58, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 18:50:58, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: null, Address: null, BuyerId: null, OrderState: null, OrderItems: null, Id: null, DomainEvents: null }, Id: 9b0db857-3169-4ded-85e0-16538724434a, CreationDate: 02/07/2020 18:50:58 }] }, Id: 9b0db857-3169-4ded-85e0-16538724434a, CreationDate: 02/07/2020 18:50:58 }] }, Id: 9b0db857-3169-4ded-85e0-16538724434a, CreationDate: 02/07/2020 18:50:58 }] } (2c6718b0)
2020-02-07T18:50:58.6457057+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T18:50:58.7560615+00:00  [INF] Executed DbCommand ("1"ms) [Parameters=["@__buyerIdentityGuid_0='?' (Size = 450)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(2) [e].[Id], [e].[IdentityGuid], [e].[Name]
FROM [Buyers] AS [e]
WHERE [e].[IdentityGuid] = @__buyerIdentityGuid_0" (0723d8ff)
2020-02-07T18:50:58.7898635+00:00  [INF] BuyerCreatedDomainEvent added to list of buyer events (70d1b556)
2020-02-07T18:51:00.8121957+00:00  [INF] Executed DbCommand ("34"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T18:51:00.8439272+00:00  [INF] order retrieved to set its buyer Order { OrderDate: 02/07/2020 18:50:58, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 95500.0, ProductId: 22, ProductName: "هدفون بی سیم نیا مدل Q8-851S", Discount: 0, PictureUri: null, Id: 6, DomainEvents: null }, OrderItem { Quantity: 1, UnitPrice: 21000000.0, ProductId: 23, ProductName: "گوشی موبایل اپل مدل iPhone 11 Pro Max A2220 دو سیم‌ کارت ظرفیت 256 گیگابایت", Discount: 0, PictureUri: null, Id: 7, DomainEvents: null }], Id: 6, DomainEvents: [] } (eee39e3d)
2020-02-07T18:51:00.8510781+00:00  [INF] orderId is 6 (6360224c)
2020-02-07T18:51:00.8558307+00:00  [INF] buyerId set to 1 (b0efb381)
2020-02-07T18:51:00.8628381+00:00  [INF] OrderStatus is set to SetAwaitingValidationStatus  (8d340758)
2020-02-07T18:51:00.9453095+00:00  [INF] OrderStatusChangedToAwaitingValidationDomainEvent handler called (622cbd86)
2020-02-07T18:51:00.9677850+00:00  [INF] OrderId is 6 (9c7ce781)
2020-02-07T18:51:00.9735112+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is created OrderStatusChangedToAwaitingValidationIntegrationEvent { StockItems: [StockItem { ProductId: 22, Units: 1 }, StockItem { ProductId: 23, Units: 1 }], OrderId: 6, Id: 00000000-0000-0000-0000-000000000000, CreationDate: 02/07/2020 18:51:00 } (ff364eea)
2020-02-07T18:51:01.2196490+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is published (5de65a50)
2020-02-07T18:51:01.2440367+00:00  [ERR] Failed executing DbCommand ("5"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (6).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:13789510-06fe-465b-8902-593aea2d8ed0
Error Number:2627,State:1,Class:14
2020-02-07T18:51:01.3910137+00:00  [INF] SetOrderStatusToStockConfirmedCommand created:SetOrderStatusToStockConfirmedCommand { orderId: 6 }  (5429d522)
2020-02-07T18:51:01.3965804+00:00  [INF] Order will be retrieved with Id= 6 (535d6bce)
2020-02-07T18:51:01.4192821+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T18:51:01.4202239+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (6).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (6).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T18:51:02.4253972+00:00  [INF] Executed DbCommand ("998"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T18:51:02.5561720+00:00  [INF] Executed DbCommand ("8"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T18:51:02.5641424+00:00  [INF] Order retrieved Order { OrderDate: 02/07/2020 14:43:33, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: 1, OrderState: Cancelled, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 85000.00, ProductId: 20, ProductName: "ماوس گرین GM-101", Discount: 0.00, PictureUri: null, Id: 6, DomainEvents: null }], Id: 6, DomainEvents: null } (6f81d885)
2020-02-07T18:51:02.5706298+00:00  [INF] SetStockConfirmedStatus called on order object (37636d94)
2020-02-07T18:51:02.5968145+00:00  [INF] SaveChanges finished  (90950fbb)
2020-02-07T18:51:02.6082638+00:00  [INF] SetOrderStatusToStockConfirmedCommand sent  (74dba639)
2020-02-07T18:51:02.6194300+00:00  [ERR] Failed executing DbCommand ("25"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (6).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:13789510-06fe-465b-8902-593aea2d8ed0
Error Number:2627,State:1,Class:14
2020-02-07T18:51:02.6826531+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (6).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (6).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Ordering.Infrastructure.OrderingContext.SaveChangesAsync() in E:\InHand\Desktop\Microservices\Final Project\eShop\src\Services\Ordering\Ordering.Infrastructure\OrderingContext.cs:line 56
2020-02-07T18:51:03.6330996+00:00  [INF] SaveChanges called on buyer (3505242c)
2020-02-07T18:51:03.7230718+00:00  [ERR] Failed executing DbCommand ("29"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (627a98df)
System.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (6).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:13789510-06fe-465b-8902-593aea2d8ed0
Error Number:2627,State:1,Class:14
2020-02-07T18:51:03.7951424+00:00  [ERR] An exception occurred in the database while saving changes for context type '"Ordering.Infrastructure.OrderingContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (6).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: Violation of PRIMARY KEY constraint 'PK_Orders'. Cannot insert duplicate key in object 'dbo.Orders'. The duplicate key value is (6).
The statement has been terminated.
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2020-02-07T18:51:04.8612500+00:00  [INF] Order SaveChanges finished (85d05615)
2020-02-07T18:51:04.8681945+00:00  [INF] CreateOrderCommand sent (8a728658)
2020-02-07T18:51:14.1009481+00:00 0HLTBVOTC3V1G:0000000B [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c   (ca22a1cb)
2020-02-07T18:51:14.1064890+00:00 0HLTBVOTC3V1G:0000000B [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:51:14.1129048+00:00 0HLTBVOTC3V1G:0000000B [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:51:14.1210934+00:00 0HLTBVOTC3V1G:0000000B [INF] Request finished in 37.1989ms 204  (791a596a)
2020-02-07T18:51:14.1371630+00:00 0HLTBVOTC3V1G:0000000C [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c application/json; charset=utf-8  (ca22a1cb)
2020-02-07T18:51:14.1421640+00:00 0HLTBVOTC3V1G:0000000C [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:51:14.1477495+00:00 0HLTBVOTC3V1G:0000000C [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:51:14.1705290+00:00 0HLTBVOTC3V1G:0000000C [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (500cc934)
2020-02-07T18:51:14.1985545+00:00 0HLTBVOTC3V1G:0000000C [INF] Route matched with "{action = \"GetLatestOrderForUser\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetLatestOrderForUser(System.String)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T18:51:14.2099312+00:00 0HLTBVOTC3V1G:0000000C [INF] Executing action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T18:51:14.2405163+00:00 0HLTBVOTC3V1G:0000000C [INF] Executed action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 23.4468ms. (50a9e262)
2020-02-07T18:51:14.2684487+00:00 0HLTBVOTC3V1G:0000000C [INF] Executing ObjectResult, writing value of type '"System.String"'. (8a1b66c8)
2020-02-07T18:51:14.2738942+00:00 0HLTBVOTC3V1G:0000000C [INF] Executed action "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" in 70.0325ms (afa2e885)
2020-02-07T18:51:14.2823183+00:00 0HLTBVOTC3V1G:0000000C [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (99874f2b)
2020-02-07T18:51:14.3044056+00:00 0HLTBVOTC3V1G:0000000C [INF] Request finished in 153.4772ms 200 application/json; charset=utf-8 (791a596a)
2020-02-07T18:53:15.9464176+00:00  [INF] Inside UserCheckoutIntegrationEvent handler (3529aed2)
2020-02-07T18:53:15.9668263+00:00  [INF] CreateOrderCommand created CreateOrderCommand { OrderItems: [OrderItemDto { ProductId: 22, ProductName: "هدفون بی سیم نیا مدل Q8-851S", Quantity: 1, UnitPrice: 95500.0, Discount: 0 }], UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", City: "تهران", State: "تهران", Country: "ایران", Street: "آذربایجان", ZipCode: "123456" } (3fd9f466)
2020-02-07T18:53:15.9866757+00:00  [INF] Order instantiated Order { OrderDate: 02/07/2020 18:53:15, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 18:53:15, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 18:53:15, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: null, Address: null, BuyerId: null, OrderState: null, OrderItems: null, Id: null, DomainEvents: null }, Id: 9305973d-b391-4025-8303-f8fe48fc4d87, CreationDate: 02/07/2020 18:53:15 }] }, Id: 9305973d-b391-4025-8303-f8fe48fc4d87, CreationDate: 02/07/2020 18:53:15 }] }, Id: 9305973d-b391-4025-8303-f8fe48fc4d87, CreationDate: 02/07/2020 18:53:15 }] } (2c6718b0)
2020-02-07T18:53:15.9939588+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T18:53:16.0420159+00:00  [INF] Executed DbCommand ("4"ms) [Parameters=["@__buyerIdentityGuid_0='?' (Size = 450)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(2) [e].[Id], [e].[IdentityGuid], [e].[Name]
FROM [Buyers] AS [e]
WHERE [e].[IdentityGuid] = @__buyerIdentityGuid_0" (0723d8ff)
2020-02-07T18:53:16.0729341+00:00  [INF] BuyerCreatedDomainEvent added to list of buyer events (70d1b556)
2020-02-07T18:53:16.1408345+00:00  [INF] Executed DbCommand ("7"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T18:53:16.1530478+00:00  [INF] order retrieved to set its buyer Order { OrderDate: 02/07/2020 18:53:15, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 95500.0, ProductId: 22, ProductName: "هدفون بی سیم نیا مدل Q8-851S", Discount: 0, PictureUri: null, Id: 8, DomainEvents: null }], Id: 7, DomainEvents: [] } (eee39e3d)
2020-02-07T18:53:16.2048693+00:00  [INF] orderId is 7 (6360224c)
2020-02-07T18:53:16.2328269+00:00  [INF] buyerId set to 1 (b0efb381)
2020-02-07T18:53:16.2388612+00:00  [INF] OrderStatus is set to SetAwaitingValidationStatus  (8d340758)
2020-02-07T18:53:16.3089953+00:00  [INF] OrderStatusChangedToAwaitingValidationDomainEvent handler called (622cbd86)
2020-02-07T18:53:16.3146986+00:00  [INF] OrderId is 7 (9c7ce781)
2020-02-07T18:53:16.3192921+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is created OrderStatusChangedToAwaitingValidationIntegrationEvent { StockItems: [StockItem { ProductId: 22, Units: 1 }], OrderId: 7, Id: 00000000-0000-0000-0000-000000000000, CreationDate: 02/07/2020 18:53:16 } (ff364eea)
2020-02-07T18:53:16.3870504+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is published (5de65a50)
2020-02-07T18:53:16.4029243+00:00  [INF] Executed DbCommand ("3"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (0723d8ff)
2020-02-07T18:53:16.4150592+00:00  [INF] Executed DbCommand ("4"ms) [Parameters=["@p10='?' (DbType = Int32), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (Size = 4000), @p16='?' (DbType = Int32), @p17='?' (DbType = Decimal)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [OrderItems] ([Id], [Discount], [OrderId], [PictureUri], [ProductId], [ProductName], [Quantity], [UnitPrice])
VALUES (@p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);" (0723d8ff)
2020-02-07T18:53:16.4496634+00:00  [INF] SaveChanges called on buyer (3505242c)
2020-02-07T18:53:16.4544627+00:00  [INF] Order SaveChanges finished (85d05615)
2020-02-07T18:53:16.4622840+00:00  [INF] CreateOrderCommand sent (8a728658)
2020-02-07T18:53:16.5331079+00:00  [INF] SetOrderStatusToStockConfirmedCommand created:SetOrderStatusToStockConfirmedCommand { orderId: 7 }  (5429d522)
2020-02-07T18:53:16.5407580+00:00  [INF] Order will be retrieved with Id= 7 (535d6bce)
2020-02-07T18:53:16.5497962+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T18:53:16.5908676+00:00  [INF] Executed DbCommand ("29"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T18:53:16.6117263+00:00  [INF] Executed DbCommand ("4"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T18:53:16.6295217+00:00  [INF] Order retrieved Order { OrderDate: 02/07/2020 18:53:15, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: 1, OrderState: AwaitingValidation, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 95500.00, ProductId: 22, ProductName: "هدفون بی سیم نیا مدل Q8-851S", Discount: 0.00, PictureUri: null, Id: 8, DomainEvents: null }], Id: 7, DomainEvents: null } (6f81d885)
2020-02-07T18:53:16.6424826+00:00  [INF] SetStockConfirmedStatus called on order object (37636d94)
2020-02-07T18:53:16.6874193+00:00  [INF] Executed DbCommand ("1"ms) [Parameters=["@p2='?' (DbType = Int32), @p0='?' (DbType = Int16), @p1='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
UPDATE [Orders] SET [OrderState] = @p0, [Description] = @p1
WHERE [Id] = @p2;
SELECT @@ROWCOUNT;" (0723d8ff)
2020-02-07T18:53:16.7151328+00:00  [INF] SaveChanges finished  (90950fbb)
2020-02-07T18:53:16.7199833+00:00  [INF] SetOrderStatusToStockConfirmedCommand sent  (74dba639)
2020-02-07T18:53:50.6237023+00:00 0HLTBVOTC3V1G:0000000D [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c   (ca22a1cb)
2020-02-07T18:53:50.6478029+00:00 0HLTBVOTC3V1G:0000000D [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:53:50.6772097+00:00 0HLTBVOTC3V1G:0000000D [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:53:50.7001480+00:00 0HLTBVOTC3V1G:0000000D [INF] Request finished in 60.2916ms 204  (791a596a)
2020-02-07T18:53:50.7246618+00:00 0HLTBVOTC3V1G:0000000E [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c application/json; charset=utf-8  (ca22a1cb)
2020-02-07T18:53:50.7323358+00:00 0HLTBVOTC3V1G:0000000E [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:53:50.7393063+00:00 0HLTBVOTC3V1G:0000000E [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:53:50.7451576+00:00 0HLTBVOTC3V1G:0000000E [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (500cc934)
2020-02-07T18:53:50.7528198+00:00 0HLTBVOTC3V1G:0000000E [INF] Route matched with "{action = \"GetLatestOrderForUser\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetLatestOrderForUser(System.String)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T18:53:50.7585867+00:00 0HLTBVOTC3V1G:0000000E [INF] Executing action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T18:53:50.7724013+00:00 0HLTBVOTC3V1G:0000000E [INF] Executed action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 6.7323ms. (50a9e262)
2020-02-07T18:53:50.7966006+00:00 0HLTBVOTC3V1G:0000000E [INF] Executing ObjectResult, writing value of type '"System.String"'. (8a1b66c8)
2020-02-07T18:53:50.8106017+00:00 0HLTBVOTC3V1G:0000000E [INF] Executed action "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" in 44.9935ms (afa2e885)
2020-02-07T18:53:50.8156026+00:00 0HLTBVOTC3V1G:0000000E [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (99874f2b)
2020-02-07T18:53:50.8237898+00:00 0HLTBVOTC3V1G:0000000E [INF] Request finished in 98.9773ms 200 application/json; charset=utf-8 (791a596a)
2020-02-07T18:54:03.4838426+00:00  [INF] Inside UserCheckoutIntegrationEvent handler (3529aed2)
2020-02-07T18:54:03.5057108+00:00  [INF] CreateOrderCommand created CreateOrderCommand { OrderItems: [OrderItemDto { ProductId: 5, ProductName: "گوشی موبایل سامسونگ مدل Galaxy A20 SM-A205F/DS دو سیم کارت ظرفیت 32گیگابایت", Quantity: 1, UnitPrice: 2510000.0, Discount: 0 }], UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", City: "تهران", State: "تهران", Country: "ایران", Street: "آذربایجان", ZipCode: "123456" } (3fd9f466)
2020-02-07T18:54:03.5183991+00:00  [INF] Order instantiated Order { OrderDate: 02/07/2020 18:54:03, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 18:54:03, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 18:54:03, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: null, Address: null, BuyerId: null, OrderState: null, OrderItems: null, Id: null, DomainEvents: null }, Id: 6a9caa3f-0a49-48fd-962c-fa9a0189c013, CreationDate: 02/07/2020 18:54:03 }] }, Id: 6a9caa3f-0a49-48fd-962c-fa9a0189c013, CreationDate: 02/07/2020 18:54:03 }] }, Id: 6a9caa3f-0a49-48fd-962c-fa9a0189c013, CreationDate: 02/07/2020 18:54:03 }] } (2c6718b0)
2020-02-07T18:54:03.5292063+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T18:54:03.5983368+00:00  [INF] Executed DbCommand ("22"ms) [Parameters=["@__buyerIdentityGuid_0='?' (Size = 450)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(2) [e].[Id], [e].[IdentityGuid], [e].[Name]
FROM [Buyers] AS [e]
WHERE [e].[IdentityGuid] = @__buyerIdentityGuid_0" (0723d8ff)
2020-02-07T18:54:03.6144139+00:00  [INF] BuyerCreatedDomainEvent added to list of buyer events (70d1b556)
2020-02-07T18:54:03.6472140+00:00  [INF] Executed DbCommand ("1"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T18:54:03.6833128+00:00  [INF] order retrieved to set its buyer Order { OrderDate: 02/07/2020 18:54:03, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 2510000.0, ProductId: 5, ProductName: "گوشی موبایل سامسونگ مدل Galaxy A20 SM-A205F/DS دو سیم کارت ظرفیت 32گیگابایت", Discount: 0, PictureUri: null, Id: 9, DomainEvents: null }], Id: 8, DomainEvents: [] } (eee39e3d)
2020-02-07T18:54:03.7160106+00:00  [INF] orderId is 8 (6360224c)
2020-02-07T18:54:03.7208282+00:00  [INF] buyerId set to 1 (b0efb381)
2020-02-07T18:54:03.7439159+00:00  [INF] OrderStatus is set to SetAwaitingValidationStatus  (8d340758)
2020-02-07T18:54:04.4031888+00:00  [INF] OrderStatusChangedToAwaitingValidationDomainEvent handler called (622cbd86)
2020-02-07T18:54:04.4249877+00:00  [INF] OrderId is 8 (9c7ce781)
2020-02-07T18:54:04.4488243+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is created OrderStatusChangedToAwaitingValidationIntegrationEvent { StockItems: [StockItem { ProductId: 5, Units: 1 }], OrderId: 8, Id: 00000000-0000-0000-0000-000000000000, CreationDate: 02/07/2020 18:54:04 } (ff364eea)
2020-02-07T18:54:04.8476310+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is published (5de65a50)
2020-02-07T18:54:04.9495008+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (0723d8ff)
2020-02-07T18:54:04.9651171+00:00  [INF] Executed DbCommand ("9"ms) [Parameters=["@p10='?' (DbType = Int32), @p11='?' (DbType = Decimal), @p12='?' (DbType = Int32), @p13='?' (Size = 4000), @p14='?' (DbType = Int32), @p15='?' (Size = 4000), @p16='?' (DbType = Int32), @p17='?' (DbType = Decimal)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [OrderItems] ([Id], [Discount], [OrderId], [PictureUri], [ProductId], [ProductName], [Quantity], [UnitPrice])
VALUES (@p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);" (0723d8ff)
2020-02-07T18:54:04.9770856+00:00  [INF] SaveChanges called on buyer (3505242c)
2020-02-07T18:54:04.9856847+00:00  [INF] Order SaveChanges finished (85d05615)
2020-02-07T18:54:04.9922776+00:00  [INF] CreateOrderCommand sent (8a728658)
2020-02-07T18:54:05.0719106+00:00  [INF] SetOrderStatusToStockConfirmedCommand created:SetOrderStatusToStockConfirmedCommand { orderId: 8 }  (5429d522)
2020-02-07T18:54:05.0793845+00:00  [INF] Order will be retrieved with Id= 8 (535d6bce)
2020-02-07T18:54:05.1091158+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T18:54:05.1413302+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T18:54:05.2251697+00:00  [INF] Executed DbCommand ("24"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T18:54:05.2318867+00:00  [INF] Order retrieved Order { OrderDate: 02/07/2020 18:54:03, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: 1, OrderState: AwaitingValidation, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 2510000.00, ProductId: 5, ProductName: "گوشی موبایل سامسونگ مدل Galaxy A20 SM-A205F/DS دو سیم کارت ظرفیت 32گیگابایت", Discount: 0.00, PictureUri: null, Id: 9, DomainEvents: null }], Id: 8, DomainEvents: null } (6f81d885)
2020-02-07T18:54:05.2381053+00:00  [INF] SetStockConfirmedStatus called on order object (37636d94)
2020-02-07T18:54:05.3057660+00:00  [INF] Executed DbCommand ("1"ms) [Parameters=["@p2='?' (DbType = Int32), @p0='?' (DbType = Int16), @p1='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
UPDATE [Orders] SET [OrderState] = @p0, [Description] = @p1
WHERE [Id] = @p2;
SELECT @@ROWCOUNT;" (0723d8ff)
2020-02-07T18:54:05.3179971+00:00  [INF] SaveChanges finished  (90950fbb)
2020-02-07T18:54:05.3232595+00:00  [INF] SetOrderStatusToStockConfirmedCommand sent  (74dba639)
2020-02-07T18:54:20.4709532+00:00 0HLTBVOTC3V1G:0000000F [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c   (ca22a1cb)
2020-02-07T18:54:20.4805874+00:00 0HLTBVOTC3V1G:0000000F [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:54:20.4859582+00:00 0HLTBVOTC3V1G:0000000F [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:54:20.4926962+00:00 0HLTBVOTC3V1G:0000000F [INF] Request finished in 24.8664ms 204  (791a596a)
2020-02-07T18:54:20.5395080+00:00 0HLTBVOTC3V1G:00000010 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c application/json; charset=utf-8  (ca22a1cb)
2020-02-07T18:54:20.5472031+00:00 0HLTBVOTC3V1G:00000010 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:54:20.5553570+00:00 0HLTBVOTC3V1G:00000010 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:54:20.5612704+00:00 0HLTBVOTC3V1G:00000010 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (500cc934)
2020-02-07T18:54:20.5670991+00:00 0HLTBVOTC3V1G:00000010 [INF] Route matched with "{action = \"GetLatestOrderForUser\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetLatestOrderForUser(System.String)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T18:54:20.5770198+00:00 0HLTBVOTC3V1G:00000010 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T18:54:20.5906829+00:00 0HLTBVOTC3V1G:00000010 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 3.9044ms. (50a9e262)
2020-02-07T18:54:20.6155573+00:00 0HLTBVOTC3V1G:00000010 [INF] Executing ObjectResult, writing value of type '"System.String"'. (8a1b66c8)
2020-02-07T18:54:20.6207186+00:00 0HLTBVOTC3V1G:00000010 [INF] Executed action "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" in 48.6701ms (afa2e885)
2020-02-07T18:54:20.6258155+00:00 0HLTBVOTC3V1G:00000010 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (99874f2b)
2020-02-07T18:54:20.6337546+00:00 0HLTBVOTC3V1G:00000010 [INF] Request finished in 108.2292ms 200 application/json; charset=utf-8 (791a596a)
2020-02-07T18:54:39.6564570+00:00 0HLTBVOTC3V1G:00000011 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/all?pageSize=5&pageIndex=0   (ca22a1cb)
2020-02-07T18:54:39.6712662+00:00 0HLTBVOTC3V1G:00000011 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:54:39.6776830+00:00 0HLTBVOTC3V1G:00000011 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:54:39.6876846+00:00 0HLTBVOTC3V1G:00000011 [INF] Request finished in 36.3484ms 204  (791a596a)
2020-02-07T18:54:39.7027146+00:00 0HLTBVOTC3V1G:00000012 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/all?pageSize=5&pageIndex=0 application/json; charset=utf-8  (ca22a1cb)
2020-02-07T18:54:39.7281747+00:00 0HLTBVOTC3V1G:00000012 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T18:54:39.7518430+00:00 0HLTBVOTC3V1G:00000012 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T18:54:39.7580529+00:00 0HLTBVOTC3V1G:00000012 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetAll (Ordering.API)"' (500cc934)
2020-02-07T18:54:39.7633969+00:00 0HLTBVOTC3V1G:00000012 [INF] Route matched with "{action = \"GetAll\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetAll(Int32, Int32)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T18:54:39.8181828+00:00 0HLTBVOTC3V1G:00000012 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T18:54:39.9313623+00:00 0HLTBVOTC3V1G:00000012 [INF] GetAll action inside Order Controller (ed7fa128)
2020-02-07T18:54:39.9401842+00:00 0HLTBVOTC3V1G:00000012 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 113.1911ms. (50a9e262)
2020-02-07T18:54:39.9448119+00:00 0HLTBVOTC3V1G:00000012 [INF] Executing ObjectResult, writing value of type '"Ordering.QueryModel.ViewModels.PagedResult`1[[Ordering.QueryModel.ViewModels.OrderSummeryViewModel, Ordering.QueryModel, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]"'. (8a1b66c8)
2020-02-07T18:54:39.9715915+00:00 0HLTBVOTC3V1G:00000012 [INF] Executed action "Ordering.API.Controllers.OrderController.GetAll (Ordering.API)" in 202.3792ms (afa2e885)
2020-02-07T18:54:39.9778425+00:00 0HLTBVOTC3V1G:00000012 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetAll (Ordering.API)"' (99874f2b)
2020-02-07T18:54:39.9850385+00:00 0HLTBVOTC3V1G:00000012 [INF] Request finished in 281.895ms 200 application/json; charset=utf-8 (791a596a)
2020-02-07T19:09:33.2215915+00:00  [INF] Inside UserCheckoutIntegrationEvent handler (3529aed2)
2020-02-07T19:09:33.2267968+00:00  [INF] CreateOrderCommand created CreateOrderCommand { OrderItems: [OrderItemDto { ProductId: 22, ProductName: "هدفون بی سیم نیا مدل Q8-851S", Quantity: 1, UnitPrice: 95500.0, Discount: 0 }, OrderItemDto { ProductId: 3, ProductName: "گوشی موبایل هوآوی مدل Y3 2018 CAG-L22 دو سیم کارت ظرفیت 8 گیگابایت", Quantity: 1, UnitPrice: 1500000.0, Discount: 0 }], UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", City: "تهران", State: "تهران", Country: "ایران", Street: "آذربایجان", ZipCode: "123456" } (3fd9f466)
2020-02-07T19:09:33.2419560+00:00  [INF] Order instantiated Order { OrderDate: 02/07/2020 19:09:33, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 19:09:33, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: 02/07/2020 19:09:33, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [], Id: 0, DomainEvents: [OrderStartedDomainEvent { UserId: "16265bdc-0e49-44df-b6e5-e77094ee6d0c", UserName: "masoud", Order: Order { OrderDate: null, Address: null, BuyerId: null, OrderState: null, OrderItems: null, Id: null, DomainEvents: null }, Id: c680c713-2650-43b6-977b-532239d2e9ba, CreationDate: 02/07/2020 19:09:33 }] }, Id: c680c713-2650-43b6-977b-532239d2e9ba, CreationDate: 02/07/2020 19:09:33 }] }, Id: c680c713-2650-43b6-977b-532239d2e9ba, CreationDate: 02/07/2020 19:09:33 }] } (2c6718b0)
2020-02-07T19:09:33.2602695+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T19:09:33.3687334+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=["@__buyerIdentityGuid_0='?' (Size = 450)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(2) [e].[Id], [e].[IdentityGuid], [e].[Name]
FROM [Buyers] AS [e]
WHERE [e].[IdentityGuid] = @__buyerIdentityGuid_0" (0723d8ff)
2020-02-07T19:09:33.4009753+00:00  [INF] BuyerCreatedDomainEvent added to list of buyer events (70d1b556)
2020-02-07T19:09:33.5222402+00:00  [INF] Executed DbCommand ("9"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T19:09:33.5575512+00:00  [INF] order retrieved to set its buyer Order { OrderDate: 02/07/2020 19:09:33, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: null, OrderState: Submitted, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 95500.0, ProductId: 22, ProductName: "هدفون بی سیم نیا مدل Q8-851S", Discount: 0, PictureUri: null, Id: 10, DomainEvents: null }, OrderItem { Quantity: 1, UnitPrice: 1500000.0, ProductId: 3, ProductName: "گوشی موبایل هوآوی مدل Y3 2018 CAG-L22 دو سیم کارت ظرفیت 8 گیگابایت", Discount: 0, PictureUri: null, Id: 11, DomainEvents: null }], Id: 9, DomainEvents: [] } (eee39e3d)
2020-02-07T19:09:33.5933301+00:00  [INF] orderId is 9 (6360224c)
2020-02-07T19:09:33.6009354+00:00  [INF] buyerId set to 1 (b0efb381)
2020-02-07T19:09:33.6084891+00:00  [INF] OrderStatus is set to SetAwaitingValidationStatus  (8d340758)
2020-02-07T19:09:33.6310734+00:00  [INF] OrderStatusChangedToAwaitingValidationDomainEvent handler called (622cbd86)
2020-02-07T19:09:33.6390605+00:00  [INF] OrderId is 9 (9c7ce781)
2020-02-07T19:09:33.6470872+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is created OrderStatusChangedToAwaitingValidationIntegrationEvent { StockItems: [StockItem { ProductId: 22, Units: 1 }, StockItem { ProductId: 3, Units: 1 }], OrderId: 9, Id: 00000000-0000-0000-0000-000000000000, CreationDate: 02/07/2020 19:09:33 } (ff364eea)
2020-02-07T19:09:33.8029478+00:00  [INF] OrderStatusChangedToAwaitingValidationIntegrationEvent is published (5de65a50)
2020-02-07T19:09:33.8457623+00:00  [INF] Executed DbCommand ("3"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (DbType = Int16), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [Orders] ([Id], [BuyerId], [OrderDate], [OrderState], [Description], [Address_City], [Address_Country], [Address_State], [Address_Street], [Address_ZipCode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9);" (0723d8ff)
2020-02-07T19:09:33.8670042+00:00  [INF] Executed DbCommand ("4"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Decimal), @p2='?' (DbType = Int32), @p3='?' (Size = 4000), @p4='?' (DbType = Int32), @p5='?' (Size = 4000), @p6='?' (DbType = Int32), @p7='?' (DbType = Decimal)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [OrderItems] ([Id], [Discount], [OrderId], [PictureUri], [ProductId], [ProductName], [Quantity], [UnitPrice])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);" (0723d8ff)
2020-02-07T19:09:33.8852734+00:00  [INF] Executed DbCommand ("3"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Decimal), @p2='?' (DbType = Int32), @p3='?' (Size = 4000), @p4='?' (DbType = Int32), @p5='?' (Size = 4000), @p6='?' (DbType = Int32), @p7='?' (DbType = Decimal)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
INSERT INTO [OrderItems] ([Id], [Discount], [OrderId], [PictureUri], [ProductId], [ProductName], [Quantity], [UnitPrice])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);" (0723d8ff)
2020-02-07T19:09:33.9628458+00:00  [INF] SaveChanges called on buyer (3505242c)
2020-02-07T19:09:33.9683421+00:00  [INF] Order SaveChanges finished (85d05615)
2020-02-07T19:09:33.9921943+00:00  [INF] CreateOrderCommand sent (8a728658)
2020-02-07T19:09:33.9969236+00:00  [INF] SetOrderStatusToStockConfirmedCommand created:SetOrderStatusToStockConfirmedCommand { orderId: 9 }  (5429d522)
2020-02-07T19:09:34.0068398+00:00  [INF] Order will be retrieved with Id= 9 (535d6bce)
2020-02-07T19:09:34.0187980+00:00  [INF] Entity Framework Core "2.2.6-servicing-10079" initialized '"OrderingContext"' using provider '"Microsoft.EntityFrameworkCore.SqlServer"' with options: "None" (9958f5bb)
2020-02-07T19:09:34.0491356+00:00  [INF] Executed DbCommand ("24"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [e].[Id], [e].[BuyerId], [e].[OrderDate], [e].[OrderState], [e].[Description], [e].[Id], [e].[Address_City], [e].[Address_Country], [e].[Address_State], [e].[Address_Street], [e].[Address_ZipCode]
FROM [Orders] AS [e]
WHERE [e].[Id] = @__get_Item_0" (0723d8ff)
2020-02-07T19:09:34.1211943+00:00  [INF] Executed DbCommand ("3"ms) [Parameters=["@__get_Item_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT [e].[Id], [e].[Discount], [e].[OrderId], [e].[PictureUri], [e].[ProductId], [e].[ProductName], [e].[Quantity], [e].[UnitPrice]
FROM [OrderItems] AS [e]
WHERE [e].[OrderId] = @__get_Item_0" (0723d8ff)
2020-02-07T19:09:34.1405014+00:00  [INF] Order retrieved Order { OrderDate: 02/07/2020 19:09:33, Address: Address { Street: "آذربایجان", City: "تهران", State: "تهران", Country: "ایران", ZipCode: "123456" }, BuyerId: 1, OrderState: AwaitingValidation, OrderItems: [OrderItem { Quantity: 1, UnitPrice: 95500.00, ProductId: 22, ProductName: "هدفون بی سیم نیا مدل Q8-851S", Discount: 0.00, PictureUri: null, Id: 10, DomainEvents: null }, OrderItem { Quantity: 1, UnitPrice: 1500000.00, ProductId: 3, ProductName: "گوشی موبایل هوآوی مدل Y3 2018 CAG-L22 دو سیم کارت ظرفیت 8 گیگابایت", Discount: 0.00, PictureUri: null, Id: 11, DomainEvents: null }], Id: 9, DomainEvents: null } (6f81d885)
2020-02-07T19:09:34.1622968+00:00  [INF] SetStockConfirmedStatus called on order object (37636d94)
2020-02-07T19:09:34.2143636+00:00  [INF] Executed DbCommand ("2"ms) [Parameters=["@p2='?' (DbType = Int32), @p0='?' (DbType = Int16), @p1='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET NOCOUNT ON;
UPDATE [Orders] SET [OrderState] = @p0, [Description] = @p1
WHERE [Id] = @p2;
SELECT @@ROWCOUNT;" (0723d8ff)
2020-02-07T19:09:34.2382517+00:00  [INF] SaveChanges finished  (90950fbb)
2020-02-07T19:09:34.2434453+00:00  [INF] SetOrderStatusToStockConfirmedCommand sent  (74dba639)
2020-02-07T19:09:45.0680334+00:00 0HLTBVOTC3V1H:00000001 [INF] Request starting HTTP/1.1 OPTIONS http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c   (ca22a1cb)
2020-02-07T19:09:45.0747854+00:00 0HLTBVOTC3V1H:00000001 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T19:09:45.0854364+00:00 0HLTBVOTC3V1H:00000001 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T19:09:45.0926917+00:00 0HLTBVOTC3V1H:00000001 [INF] Request finished in 23.2258ms 204  (791a596a)
2020-02-07T19:09:45.1165740+00:00 0HLTBVOTC3V1H:00000002 [INF] Request starting HTTP/1.1 GET http://localhost:9416/api/order/LatestOrderStatus/BuyerId/16265bdc-0e49-44df-b6e5-e77094ee6d0c application/json; charset=utf-8  (ca22a1cb)
2020-02-07T19:09:45.1384936+00:00 0HLTBVOTC3V1H:00000002 [WRN] The CORS protocol does not allow specifying a wildcard (any) origin and credentials at the same time. Configure the policy by listing individual origins if credentials needs to be supported. (6e5ffae2)
2020-02-07T19:09:45.1632511+00:00 0HLTBVOTC3V1H:00000002 [INF] CORS policy execution successful. (5409d6ef)
2020-02-07T19:09:45.1902752+00:00 0HLTBVOTC3V1H:00000002 [INF] Executing endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (500cc934)
2020-02-07T19:09:45.2012623+00:00 0HLTBVOTC3V1H:00000002 [INF] Route matched with "{action = \"GetLatestOrderForUser\", controller = \"Order\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult] GetLatestOrderForUser(System.String)" on controller "Ordering.API.Controllers.OrderController" ("Ordering.API"). (122b2fdf)
2020-02-07T19:09:45.2131429+00:00 0HLTBVOTC3V1H:00000002 [INF] Executing action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" - Validation state: Valid (dad538d7)
2020-02-07T19:09:45.3305395+00:00 0HLTBVOTC3V1H:00000002 [INF] Executed action method "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)", returned result "Microsoft.AspNetCore.Mvc.OkObjectResult" in 86.7923ms. (50a9e262)
2020-02-07T19:09:45.3599070+00:00 0HLTBVOTC3V1H:00000002 [INF] Executing ObjectResult, writing value of type '"System.String"'. (8a1b66c8)
2020-02-07T19:09:45.3653281+00:00 0HLTBVOTC3V1H:00000002 [INF] Executed action "Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)" in 159.3372ms (afa2e885)
2020-02-07T19:09:45.3739834+00:00 0HLTBVOTC3V1H:00000002 [INF] Executed endpoint '"Ordering.API.Controllers.OrderController.GetLatestOrderForUser (Ordering.API)"' (99874f2b)
2020-02-07T19:09:45.4208778+00:00 0HLTBVOTC3V1H:00000002 [INF] Request finished in 306.0398ms 200 application/json; charset=utf-8 (791a596a)
